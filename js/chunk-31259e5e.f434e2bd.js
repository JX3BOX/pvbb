(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31259e5e"],{"00fd":function(t,e,n){var i=n("9e69"),o=Object.prototype,s=o.hasOwnProperty,r=o.toString,a=i?i.toStringTag:void 0;function l(t){var e=s.call(t,a),n=t[a];try{t[a]=void 0;var i=!0}catch(l){}var o=r.call(t);return i&&(e?t[a]=n:delete t[a]),o}t.exports=l},"02aa":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("CommunitySingleLayout",{attrs:{post:t.post}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-community-single"},[e("div",{staticClass:"m-community-header"},[e("PostHeader",{attrs:{post:t.post,stat:t.stat},scopedSlots:t._u([{key:"append",fn:function(){return[e("el-pagination",{staticClass:"m-pageheader-pagination",attrs:{layout:"prev, pager, next","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page,size:"small"},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})]},proxy:!0}])}),e("Collection",{staticClass:"m-single-collection",attrs:{id:t.collection_id,defaultVisible:t.collection_collapse},on:{collectionUpdate:t.updateCollection}}),e("el-divider",{attrs:{"content-position":"left"}},[t._v("JX3BOX")])],1),e("div",{staticClass:"m-list-box"},[e("div",{staticClass:"m-master-box"},[1===this.page?e("ReplyItem",{attrs:{"null-tip":t.null_tip,isMaster:!0,post:t.post},on:{onReplyTopic:t.handleReplyTopic,enterPwd:t.enterPwd}}):t._e()],1),e("div",{staticClass:"m-reply-box"},t._l(t.replyList,(function(n,i){return e("ReplyItem",{key:i,attrs:{post:n,"is-master":!1,"is-author":t.isAuthor}})})),1)]),e("div",{staticClass:"m-community-footer"},[e("el-button",{staticClass:"u-more-buttom",style:{fontSize:t.hasNextPage?"14px":"12px"},attrs:{type:t.hasNextPage?"primary":"text",loading:t.loading,disabled:!t.hasNextPage,icon:t.hasNextPage?"el-icon-arrow-down":""},on:{click:t.nextPage}},[t._v(" "+t._s(t.hasNextPage?"下一页":"没有更多了")+" ")]),e("div",{staticClass:"m-pagination-box"},[e("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next, jumper","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})],1),e("div",{staticClass:"u-editor"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("回帖")]),e("CommentEditor",{on:{submit:t.onReplyTopic}})],1)],1)]),e("Homework",{attrs:{title:"答谢",postType:t.postType,postId:t.postId,client:t.postClient,userId:t.postUserId,"article-id":~~t.id,category:"community"},model:{value:t.showHomeWork,callback:function(e){t.showHomeWork=e},expression:"showHomeWork"}}),e("boxCoinRecords",{attrs:{postType:t.postType,postId:t.postId,client:t.postClient},model:{value:t.showBoxCoin,callback:function(e){t.showBoxCoin=e},expression:"showBoxCoin"}}),e("el-dialog",{attrs:{visible:t.showComment,title:"快捷回复",width:t.isPhone?"95%":""},on:{"update:visible":function(e){t.showComment=e}}},[e("CommentEditor",{on:{submit:t.onReplyTopic}})],1),e("go-to-top-or-bottom"),e("div",{staticClass:"w-jx3-element-pop",style:t.jx3_element.style},[e("jx3-author",{directives:[{name:"show",rawName:"v-show",value:"author"===t.jx3_element.type,expression:"jx3_element.type === 'author'"}],attrs:{uid:t.author.id}})],1)],1)},o=[],s=n("5530"),r=n("c14f"),a=n("1da1"),l=(n("7db0"),n("caad"),n("a15b"),n("d81d"),n("14d9"),n("b0c0"),n("e9f5"),n("f665"),n("ab43"),n("a9e3"),n("b64b"),n("d3b7"),n("2532"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-reply-wrapper",attrs:{id:"floor-".concat(t.post.floor)}},[e("div",{staticClass:"m-reply-left"},[e("CommentUser",{attrs:{uid:t.userInfo.id,isMaster:t.isMaster}}),e("div",{staticClass:"u-top-right u-mobile-show"},[e("div",{staticClass:"u-floor"},[t._v(t._s(t.isMaster?"楼主":"#"+t.post.floor))]),e("div",{staticClass:"m-reply-time"},[t._v(t._s(t.showTime))])])],1),e("div",{staticClass:"m-reply-right"},[e("div",{staticClass:"m-reply-content"},[e("div",{staticClass:"u-reply-floor u-mobile-hidden"},[e("a",{attrs:{href:"#floor-".concat(t.post.floor)},on:{click:t.onFloorClick}},[t._v(t._s(t.isMaster?"楼主":t.post.floor+"楼"))]),e("span",{staticClass:"u-comment-time u-mobile-hidden"},[t._v(t._s(t.post.updated_at))]),e("div",{staticClass:"u-reply-op"},[t.isSuper||t.isFollower?e("el-button",{staticClass:"u-mobile-hidden",attrs:{type:"text",icon:"el-icon-edit-outline",size:"mini"},on:{click:t.onEdit}},[t._v("编辑")]):t._e()],1)]),t.isMaster?t._e():e("span",{staticClass:"u-boxcoin"},[t.isLogin&&!t.isMaster?e("el-button",{staticClass:"u-mobile-hidden",attrs:{type:"text",size:"mini"},on:{click:t.onThx}},[e("span",{staticClass:"u-thx"},[e("img",{attrs:{src:n("8b3c"),alt:"答谢"}}),t._v(" 答谢 ")])]):t._e(),t.boxCoinTotal?e("span",{staticClass:"u-boxcoin-total",on:{click:function(e){return e.stopPropagation(),t.onBoxcoinClick.apply(null,arguments)}}},[t._v(" 收到"),e("span",{staticClass:"u-boxcoin-num"},[t._v(t._s(t.boxCoinTotal))]),e("i",{staticClass:"el-icon-coin"})]):t._e()],1),e("div",{staticClass:"u-reply-content"},[t.visible?[t.isMaster?e("Article",{attrs:{content:t.post.content||""}}):t._e()]:t.isMaster?e("div",{staticClass:"m-single-null"},[t.post.visible>1&&3!=t.post.visible?e("el-alert",{attrs:{type:"warning","show-icon":""},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",[t._v(t._s(t.nullTip))]),t.isLogin?e("a",{staticClass:"u-pwd-text",on:{click:t.enterPwd}},[t._v("输入密码")]):t._e()]},proxy:!0}],null,!1,1742966331)}):t._e(),3==t.post.visible?[e("div",{staticClass:"m-pwd-box"},[e("i",{staticClass:"u-pwd-icon el-icon-lock"}),e("div",{staticClass:"u-pwd-tip"},[t._v("作者设置了密码可见")]),e("el-input",{staticClass:"u-pwd-input",attrs:{placeholder:"请输入密码","show-password":"",clearable:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[t._v("密码")]},proxy:!0}],null,!1,1528252290),model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),e("el-button",{staticClass:"u-pwd-btn",attrs:{type:"primary"},on:{click:t.enterPwd}},[t._v("确认")])],1)]:t._e()],2):t._e(),t.isMaster?t._e():e("div",{domProps:{innerHTML:t._s(t.renderContent)}}),t.extraImages&&t.extraImages.length&&t.isMaster&&t.isFromPhone?e("div",{staticClass:"m-image-box"},t._l(t.extraImages,(function(n,i){return e("a",{key:i,staticClass:"u-item"},[e("el-image",{attrs:{src:t.getSquareBanner(n),fit:"fill","preview-src-list":[n]}})],1)})),0):t._e()],2),t.isMaster?e("Thx",{staticClass:"m-single-thx",attrs:{postId:~~t.id,postType:"community_topic",postTitle:t.post.title,userId:t.post.user_id,adminBoxcoinEnable:!0,userBoxcoinEnable:!0,client:t.post.client,category:"community",showRss:"","author-id":t.post.user_id,banner:t.post.banner_img,contentMetaId:t.post.link_content_meta_id}}):t._e(),e("div",{staticClass:"u-reply-toolbar"},[e("div",[e("ForwardButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,isMaster:t.isMaster}}),e("DeleteButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,type:"reply",isMaster:t.isMaster}}),e("AddBlockButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}}),e("ComplaintButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}}),e("el-button",{staticClass:"u-reply-btn",style:t.styles,attrs:{type:"primary",size:"small"},on:{click:t.onShowReply}},[e("div",{staticClass:"u-btn"},[e("img",{attrs:{src:n("076f"),alt:""}}),e("span",[t._v(t._s(t.isMaster?"跟帖":"回复"))])])]),t.isMaster?t._e():e("el-button",{staticClass:"u-praise-btn",attrs:{disabled:t.isLike,type:"primary",size:"small"},on:{click:t.addLike}},[e("div",{staticClass:"u-btn"},[e("img",{attrs:{src:n("4a11"),alt:""}}),e("span",[t._v("赞")]),e("span",[t._v(t._s(t.likeCountRender))])])])],1),e("div",[e("el-dropdown",{staticClass:"u-more u-mobile-show",attrs:{trigger:"click",placement:"bottom"}},[e("span",{staticClass:"el-dropdown-link"},[e("i",{staticClass:"el-icon-more"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",[e("ForwardButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,isMaster:t.isMaster}})],1),t.isMaster||!t.isSuper&&!t.isFollower?t._e():e("el-dropdown-item",[e("el-button",{staticClass:"u-mobile-hidden",attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:t.onEdit}},[t._v("编辑")])],1),t.isLogin&&!t.isMaster?e("el-dropdown-item",[e("el-button",{staticClass:"u-mobile-hidden",attrs:{type:"text",icon:"el-icon-present"},on:{click:t.onThx}},[t._v("答谢")])],1):t._e(),e("el-dropdown-item",[e("DeleteButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,type:"reply",isMaster:t.isMaster}})],1),e("el-dropdown-item",[e("AddBlockButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}})],1),e("el-dropdown-item",[e("ComplaintButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}})],1)],1)],1)],1)]),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.userInfo.display_name,"user-href":t.authorLink(t.userId)},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1),!t.isMaster&&t.post.comments_count>3?e("div",{staticClass:"m-comment-collapse"},[t.isCollapse?e("div",{on:{click:t.onCollapseChange}},[e("img",{attrs:{width:"14",src:n("f315"),alt:""}}),e("span",[t._v("折叠评论")])]):e("div",{on:{click:t.onCollapseChange}},[e("img",{attrs:{width:"14",src:n("e59c"),alt:""}}),e("span",[t._v("展开评论")])])]):t._e(),!t.isMaster&&t.commentList.length?e("div",{staticClass:"m-comment-list"},t._l(t.commentList,(function(t){return e("CommentItem",{key:t.id,attrs:{post:t}})})),1):t._e(),t.isCollapse?e("div",{staticClass:"m-pagination-box"},[e("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})],1):t._e()])])}),c=[],u=(n("99af"),n("ac1f"),n("00b4"),n("5319"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-comment-user c-author m-theme",style:{backgroundImage:"url(".concat(t.bg,")")}},[e("AuthorInfo",{attrs:{uid:t.uid},on:{ready:t.installModules}}),t.data?[e("div",{staticClass:"u-interact"},[t.isMaster?e("AuthorRss",{staticStyle:{"margin-right":"8px"},attrs:{uid:t.uid}}):e("AuthorFollow",{staticStyle:{"margin-right":"8px"},attrs:{uid:t.uid}}),e("el-button",{staticClass:"u-btn",attrs:{icon:"el-icon-message",size:"mini"},on:{click:t.onMessage}},[t._v("私信")])],1),e("AuthorMedals",{staticClass:"u-block u-trophy",attrs:{uid:t.uid}}),t._t("default")]:t._e(),t.isMaster?e("AuthorCommunity",{attrs:{uid:t.uid}}):t._e()],2)}),d=[],p=(n("e9c4"),n("2ca0"),n("af4b")),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-author-follow"},[t.isFollow?e("el-popover",{attrs:{placement:"bottom",trigger:"hover","popper-class":"c-author-follow-popover","visible-arrow":!0}},[e("div",{staticClass:"u-action-list"},t._l(t.actions,(function(n){return e("div",{key:n.label,staticClass:"u-action-item",on:{click:function(t){return t.stopPropagation(),n.action.apply(null,arguments)}}},[t._v(" "+t._s(n.label)+" ")])})),0),e("el-button",{staticClass:"u-trigger",attrs:{slot:"reference",size:"mini",type:t.btnType,plain:"",icon:"el-icon-check"},slot:"reference"},[t._v(t._s(t.btnText))])],1):e("el-button",{staticClass:"u-btn",class:{"is-follow":t.isFollow,"u-fans-box":t.isSelf},attrs:{size:"mini",plain:"",icon:"el-icon-plus",loading:t.loading,disabled:t.isSelf},on:{click:t.follow}},[t._v(t._s(t.btnText))])],1)},f=[],m=(n("b680"),n("41cb"));function v(t){return Object(m["b"])().post("/api/my-userlist/follow/"+t)}function g(t){return Object(m["b"])().delete("/api/my-userlist/follow/"+t)}function b(t){return Object(m["b"])().get(`/api/followers/${t}/count`)}var y=n("c9d2"),w={name:"AuthorFollow",props:{uid:{type:Number,default:0}},data:function(){return{isFollow:!1,fansNum:0,loading:!1}},computed:{btnText:function(){return this.isFollow?"已粉":"关注"},btnType:function(){return this.isFollow?"info":"warning"},actions:function(){var t=this;return[{label:"取消关注",action:function(){t.unfollow()}}]},isSelf:function(){return this.uid==this.user.uid},user:function(){return y["a"].getInfo()},isLogin:function(){return y["a"].isLogin()}},watch:{uid:{immediate:!0,handler:function(t){t&&this.loadFans()}}},methods:{formatFansNum:function(t){return t<1e4?0===t?"":t:(t/1e4).toFixed(1)+"万"},follow:function(){var t=this;this.isLogin?v(this.uid).then((function(e){t.$message.success("关注成功"),t.isFollow=!0,t.loadFans()})).catch((function(t){console.log(t)})):y["a"].toLogin()},unfollow:function(){var t=this;this.$confirm("确定不再关注此人？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){g(t.uid).then((function(e){t.$message.success("取关成功"),t.isFollow=!1,t.loadFans()})).catch((function(t){console.log(t)}))}))},loadFans:function(){var t=this;this.uid&&(this.loading=!0,b(this.uid).then((function(e){t.fansNum=e.data.data.follower_count||0,t.isFollow=e.data.data.is_followed})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1})))}}},_=w,C=(n("96ba"),n("2877")),x=Object(C["a"])(_,h,f,!1,null,null,null),k=x.exports,T=n("6b7e"),S=n("c897"),L=function(){var t=this,e=t._self._c;return t.ready?e("div",{staticClass:"c-community-posts"},[e("div",{staticClass:"u-label"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512.092 512.092","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M396.784 446.553L266.011 115.886a10.667 10.667 0 00-8.661-6.656L54.683 85.38c-5.752-.808-11.07 3.2-11.878 8.952-.018.13-.034.261-.048.392L.091 436.057c-.763 5.841 3.353 11.196 9.194 11.959.085.011.171.021.256.03l373.333 42.667h1.216a10.667 10.667 0 0010.667-9.664l2.773-29.589a10.635 10.635 0 00-.746-4.907z",fill:"#ffa000"}}),e("path",{attrs:{d:"M469.424 94.724c-.684-5.851-5.983-10.04-11.834-9.355l-.092.011-91.733 10.795-270.933 31.871c-5.801.659-9.994 5.86-9.408 11.669l32 341.333a10.667 10.667 0 0010.667 9.664h1.216l373.333-42.667c5.853-.671 10.053-5.96 9.382-11.813a6.114 6.114 0 00-.016-.134L469.424 94.724z",fill:"#ffe082"}}),e("path",{attrs:{d:"M309.424 170.713a10.667 10.667 0 01-7.552-18.219l53.333-53.333c4.093-4.237 10.845-4.355 15.083-.262 4.237 4.093 4.354 10.845.262 15.083-.086.089-.173.176-.262.262l-53.333 53.333a10.664 10.664 0 01-7.531 3.136z",fill:"#455a64"}}),e("circle",{attrs:{cx:"394.758",cy:"74.713",r:"53.333",fill:"#f44336"}})]),e("span",[t._v("最新帖子")]),e("a",{staticClass:"u-more",attrs:{href:t._f("authorLink")(t.uid),target:"_blank"}},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 426.667 426.667","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("circle",{attrs:{cx:"42.667",cy:"213.333",r:"42.667"}}),e("circle",{attrs:{cx:"213.333",cy:"213.333",r:"42.667"}}),e("circle",{attrs:{cx:"384",cy:"213.333",r:"42.667"}})])])]),t.data&&t.data.length?e("ul",{staticClass:"u-list"},t._l(t.data,(function(n,i){return e("li",{key:i},[e("a",{staticClass:"u-item",attrs:{href:t.url(n.id,"community"),target:"_blank"}},[e("span",[e("svg",{class:"u-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M286.187 268.435L112.968 441.677c-6.875 6.876-18.021 6.876-24.897.001L45.214 398.82c-6.874-6.874-6.875-18.02-.001-24.894l117.914-117.939-69.122-69.122-48.79-48.79c-6.875-6.875-6.875-18.021 0-24.896l42.857-42.857c6.875-6.875 18.021-6.875 24.896 0l116.543 116.543 56.675 56.675c6.874 6.874 6.875 18.02.001 24.895z",fill:"#00d8de"}}),e("path",{attrs:{d:"M230.853 188.261L163.1 256.014l-25.897-25.897-43.197-43.252-48.79-48.79c-6.875-6.875-6.875-18.021 0-24.896L88.07 70.325c6.876-6.876 18.025-6.875 24.899.003l91.987 92.035 25.897 25.898z",fill:"#00a5ff"}}),e("path",{attrs:{fill:"#0087ff",d:"M230.853 188.261L163.1 256.014l-16.43-16.457 67.752-67.753z"}}),e("path",{attrs:{d:"M466.786 268.435L293.568 441.677c-6.875 6.876-18.022 6.876-24.897.001l-42.858-42.858c-6.874-6.874-6.875-18.02-.001-24.894l117.914-117.939-69.122-69.122-48.79-48.79c-6.875-6.875-6.875-18.021 0-24.896l42.857-42.857c6.875-6.875 18.021-6.875 24.896 0L410.11 186.865l56.675 56.675c6.875 6.874 6.875 18.02.001 24.895z",fill:"#00a5ff"}}),e("path",{attrs:{d:"M411.452 188.261l-67.753 67.753-25.897-25.897-43.197-43.252-48.79-48.79c-6.875-6.875-6.875-18.021 0-24.896l42.854-42.854c6.876-6.876 18.025-6.875 24.899.003l91.987 92.035 25.897 25.898z",fill:"#00d8de"}}),e("g",{attrs:{fill:"#05c1c1"}},[e("path",{attrs:{d:"M411.452 188.261l-67.753 67.753-16.43-16.457 67.753-67.753zM494.01 488.583a7.5 7.5 0 00-7.5 7.5v8.417c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-8.417a7.5 7.5 0 00-7.5-7.5zM449.738 488.583a7.5 7.5 0 00-7.5 7.5v8.417c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-8.417a7.5 7.5 0 00-7.5-7.5zM405.466 488.583a7.5 7.5 0 00-7.5 7.5v8.417c0 4.142 3.357 7.5 7.5 7.5s7.5-3.358 7.5-7.5v-8.417a7.5 7.5 0 00-7.5-7.5z"}})]),e("g",{attrs:{fill:"#0087ff"}},[e("path",{attrs:{d:"M106.534 23.417a7.5 7.5 0 007.5-7.5V7.5a7.5 7.5 0 00-15 0v8.417a7.5 7.5 0 007.5 7.5zM62.262 23.417a7.5 7.5 0 007.5-7.5V7.5a7.5 7.5 0 00-15 0v8.417a7.5 7.5 0 007.5 7.5zM17.99 0a7.5 7.5 0 00-7.5 7.5v8.417a7.5 7.5 0 0015 0V7.5a7.5 7.5 0 00-7.5-7.5z"}})])]),t._v(" "+t._s(n.title||n.category+"/无标题")+" ")])])])})),0):t._e()]):t._e()},M=[],E=n("85e4"),I=n("81fc"),O={name:"AuthorCommunity",props:["uid"],data:function(){return{data:[]}},computed:{ready:function(){return this.uid&&this.data&&this.data.length}},watch:{uid:{immediate:!0,handler:function(t){t&&this.init()}}},methods:{url:function(t,e){return Object(E["i"])(e,t)},init:function(){var t=this;Object(I["l"])({user_id:this.uid,pageSize:5}).then((function(e){t.data=e.data.data.list||[]}))}},filters:{authorLink:E["a"]}},A=O,R=(n("8372"),Object(C["a"])(A,L,M,!1,null,null,null)),j=R.exports,F=n("c402"),B=n("65c2"),D="decoration_sidebar",P={props:["uid","isMaster"],data:function(){return{data:"",bg:"",user_id:""}},watch:{uid:{handler:function(){for(var t=0;t<sessionStorage.length;t++){var e=sessionStorage.key(t);e&&e.startsWith("honor_img")&&(sessionStorage.removeItem(e),t--)}this.user_id=this.uid,this.getDecoration()},immediate:!0}},methods:{installModules:function(t){this.data=t},onMessage:function(){window.open("/dashboard/letter?receiver="+this.uid,"_blank")},showDecoration:function(t,e){return B["__cdn"]+"design/decoration/images/".concat(t,"/").concat(e,".png")},getDecoration:function(){var t=this;if(this.user_id){var e=sessionStorage.getItem(D+this.user_id)||"";if("no"!=e)try{var n=JSON.parse(e);this.bg=this.showDecoration(n.val,"sidebar")}catch(i){Object(F["b"])({using:1,user_id:this.user_id,type:"sidebar"}).then((function(e){var n=e.data.data||[];if(0!=n.length){var i=n[0];t.bg=t.showDecoration(i.val,"sidebar"),sessionStorage.setItem(D+t.user_id,JSON.stringify(i))}else sessionStorage.setItem(D+t.user_id,"no")}))}}}},components:{AuthorInfo:p["a"],AuthorFollow:k,AuthorMedals:T["a"],AuthorRss:S["a"],AuthorCommunity:j}},z=P,N=(n("2486"),Object(C["a"])(z,u,d,!1,null,null,null)),$=N.exports,H=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-subbox m-comment-editor"},[e("div",{staticClass:"u-subbox-label"},[t._v(" 回复 "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("＠"+t._s(t.username))]),t._v(" ： ")],1),e("el-form-item",[e("el-input",{attrs:{type:"textarea",id:"id"+t.inputId,placeholder:"输入回复..."},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}}),e("el-button",{staticClass:"u-publish",attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submintReply()}}},[t._v("提交")]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.hideForm()}}},[t._v("收起")])],1)])],1)},U=[],W=n("c840"),q={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Emotion:W["a"]},mounted:function(){this.currentId&&(this.inputId=this.currentId)},methods:{submintReply:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){this.$emit("hideForm")},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:t}),this.content="",this.showUploader=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){var e=this;return Object(a["a"])(Object(r["a"])().m((function n(){var i,o,s,a;return Object(r["a"])().w((function(n){while(1)switch(n.n){case 0:if(i=document.querySelector("#id".concat(e.inputId)),o=t.key,!i.selectionStart&&0!==i.selectionStart){n.n=2;break}return s=i.selectionStart,a=i.selectionEnd,e.content=i.value.substring(0,s)+o+i.value.substring(a,i.value.length),n.n=1,e.$nextTick();case 1:i.focus(),i.setSelectionRange(a+o.length,a+o.length),n.n=3;break;case 2:e.content=o;case 3:return n.a(2)}}),n)})))()}}},V=q,Y=(n("2ed4"),Object(C["a"])(V,H,U,!1,null,null,null)),K=Y.exports,J=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-comment-wrapper"},[e("div",{staticClass:"m-comment-right",style:t.decorationStyles},[e("img",{staticClass:"u-avatar",attrs:{src:t.showAvatar(t.userInfo.avatar)}}),e("div",{staticClass:"m-comment-content"},[e("div",{staticClass:"u-content-top"},[e("div",{staticClass:"u-name"},[e("a",{attrs:{href:t.authorLink(t.userInfo.id),alt:"用户名"}},[t._v(t._s(t.userInfo.display_name))]),e("span",{staticClass:"m-comment-time u-mobile-show"},[t._v(t._s(t.post.updated_at))])]),e("div",[e("el-dropdown",{staticClass:"u-more u-mobile-show",attrs:{trigger:"click",placement:"bottom"}},[e("span",{staticClass:"el-dropdown-link"},[e("i",{staticClass:"el-icon-more"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",[e("DeleteButton",{attrs:{post:t.post,type:"comment"}})],1),e("el-dropdown-item",[e("AddBlockButton",{attrs:{post:t.post}})],1),e("el-dropdown-item",[e("ComplaintButton",{attrs:{post:t.post}})],1)],1)],1)],1)]),e("p",{staticClass:"u-answer-user"},[t._v("回复 "+t._s(t.replyUserInfo.display_name)+"：")]),e("p",{staticClass:"u-content",domProps:{innerHTML:t._s(t.renderContent)}}),e("div",{staticClass:"u-comment-toolbar"},[e("div",[e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.addLike}},[e("div",{staticClass:"u-btn-content"},[e("i",{class:"u-like-icon ".concat(t.isLike&&"is-like")},[t._v(t._s(t.isLike?"♥":"♡"))]),t._v(" "+t._s(t.isLike?"已赞":"赞")+" "),t.likeCount?e("span",{staticClass:"u-count"},[t._v(" ("+t._s(t.likeCountRender)+")")]):t._e()])]),e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.onShowReply}},[e("i",{staticClass:"el-icon-chat-round"}),e("span",[t._v("回复")])])],1),e("div",{staticClass:"u-mobile-hidden"},[e("DeleteButton",{attrs:{post:t.post,type:"comment"}}),e("AddBlockButton",{attrs:{post:t.post}}),e("ComplaintButton",{attrs:{post:t.post}}),e("span",{staticClass:"m-comment-time u-mobile-hidden"},[t._v(t._s(t.post.updated_at))])],1)]),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.userInfo.display_name,"user-href":t.authorLink(t.userInfo.id)},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1)])])},Q=[],X=n("506c"),Z=n("9616"),G=function(){var t=this,e=t._self._c;return e("el-button",{attrs:{type:"text",disabled:!t.allowBlock},on:{click:function(e){return t.addBlock()}}},[e("i",{staticClass:"el-icon-circle-close"}),t._v(" 拉黑 ")])},tt=[],et={name:"add-block-button",props:["post"],computed:{isLogin:function(){return y["a"].isLogin()},allowBlock:function(){return this.isLogin&&this.post.user_id!=y["a"].getInfo().uid}},methods:{addBlock:function(){var t=this;this.$confirm("确定要拉黑此人？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["a"])(t.post.user_id).then((function(){t.$message.success("拉黑成功")})).catch((function(t){console.log(t)}))})).catch((function(t){}))}}},nt=et,it=Object(C["a"])(nt,G,tt,!1,null,"87e5968e",null),ot=it.exports,st=function(){var t=this,e=t._self._c;return e("el-button",{attrs:{type:"text",disabled:!t.allowReport},on:{click:t.onMiscfeedback}},[e("i",{staticClass:"el-icon-warning-outline"}),t._v(" 举报 ")])},rt=[],at={name:"ComplaintButton",props:["post"],inject:["getTopicData","getReplyData"],computed:{isLogin:function(){return y["a"].isLogin()},allowReport:function(){return this.isLogin&&this.post.user_id!=y["a"].getInfo().uid}},methods:{onMiscfeedback:function(){var t=this,e=this.getTopicData(),n=this.getReplyData(),i=this.post.user_info||this.post.ext_user_info,o=i.display_name,s=n.floor||0,r=s?s+"楼":"楼主";this.$prompt("请输入要举报的内容","提示",{confirmButtonText:"确定",cancelButtonText:"取消",input:"textarea",inputPlaceholder:"请输入要举报的内容",inputValidator:function(t){if(!t)return"内容不能为空!"}}).then((function(n){var i=n.value,a="魔盒论坛《".concat(e.title,"》").concat(r,"的").concat(o,"：").concat(i);Object(I["f"])({client:e.client,content:a,public:0,subtype:"3",type:"1",refer:"/community/".concat(e.id,"#").concat(s)}).then((function(){t.$message.success("举报成功")}))}))}}},lt=at,ct=Object(C["a"])(lt,st,rt,!1,null,"738d2bf8",null),ut=ct.exports,dt=function(){var t=this,e=t._self._c;return t.canDelete?e("el-button",{attrs:{type:"text"},on:{click:t.onDeleteClick}},[e("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")]):t._e()},pt=[],ht={name:"DeleteButton",inject:["getTopicData","getReplyList","getReplyData","getCommentList","onSearch"],props:["isMaster","post","type"],computed:{topicData:function(){return this.getTopicData()},replyData:function(){return this.getReplyData()},isAuthor:function(){return this.post.user_id==y["a"].getInfo().uid},isReplyToMyTopic:function(){return"reply"===this.type&&this.topicData.user_id==y["a"].getInfo().uid},isCommentToMyReply:function(){return"comment"===this.type&&this.replyData.user_id==y["a"].getInfo().uid},isSuperAdmin:function(){return y["a"].isSuperAdmin()||y["a"].hasPermission("manage_del_post")},isFollower:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==(null===(e=y["a"].getInfo())||void 0===e?void 0:e.uid)},canDelete:function(){return!this.isMaster&&(this.isSuperAdmin||this.isFollower||this.isTopicAuthor)},isTopicAuthor:function(){return this.topicData.user_id==y["a"].getInfo().uid}},methods:{onDeleteClick:function(){this.isAuthor||this.isSuperAdmin||this.isTopicAuthor?"comment"===this.type?((this.isAuthor||this.isTopicAuthor)&&this.delMyComment(),this.isSuperAdmin&&this.manageDeleteComment()):"reply"===this.type?this.isSuperAdmin?this.manageDeleteReply():this.deleteMyReply():this.$message.success("未知的组件类型："+this.type):(this.isReplyToMyTopic&&this.delReplyToMyTopic(),this.isCommentToMyReply&&this.delCommentToMyReply())},deleteMyReply:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["e"])(t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))},delMyComment:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["c"])(t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},delReplyToMyTopic:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["d"])(t.topicData.id,t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))},delCommentToMyReply:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["b"])(t.post.topic_reply_id,t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},manageDeleteComment:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["o"])(t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},manageDeleteReply:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(I["p"])(t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))}}},ft=ht,mt=Object(C["a"])(ft,dt,pt,!1,null,"a06cb580",null),vt=mt.exports,gt="decoration_comment_",bt={name:"CommentItem",props:["post"],inject:["getTopicData","getReplyData","getCommentList"],components:{ReplyForReply:K,AddBlockButton:ot,ComplaintButton:ut,DeleteButton:vt},data:function(){return{decoration:"",isLike:!1,likeCount:0,renderContent:"",showReplyForReplyFrom:!1,commentList:[]}},watch:{content:{handler:function(t){this.formatContent(t)},immediate:!0},"post.likes":{handler:function(t){this.likeCount=t},immediate:!0}},computed:{uid:function(){return this.post.user_info.id},likeCountRender:function(){return this.likeCount>=100?"99+":0!=this.likeCount?this.likeCount:""},userInfo:function(){return this.post.user_info},replyUserInfo:function(){return this.post.reply_for_user_info},comments:function(){return this.post.comments},content:function(){return this.post.content},id:function(){return this.post.id},decorationStyles:function(){return this.decoration?{backgroundImage:"url(".concat(this.decoration,")"),borderRadius:"8px"}:null}},mounted:function(){this.getDecoration()},methods:{setDecoration:function(t){this.decoration=B["__cdn"]+"design/decoration/images/".concat(t.val,"/comment.png")},getDecoration:function(){var t=this,e=sessionStorage.getItem(gt+this.uid);if(e){var n=JSON.parse(e);if(n)return void this.setDecoration(n)}Object(F["b"])({using:1,user_id:this.uid,type:"comment"}).then((function(e){var n=e.data.data,i=n.find((function(t){return"comment"==t.type}));if(i)return t.setDecoration(i),void sessionStorage.setItem(gt+t.uid,JSON.stringify(i))}))},authorLink:E["a"],formatContent:function(t){var e=this;return Object(a["a"])(Object(r["a"])().m((function n(){var i,o;return Object(r["a"])().w((function(n){while(1)switch(n.n){case 0:return i=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])(?![^<>]*>)/gi,t=t.replace(i,(function(t,e){return/src="[^"]*"/i.test(t)||-1==t.indexOf("jx3box.com")?t:'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")})),o=new X["a"](t),n.n=1,o._renderHTML();case 1:e.renderContent=n.v;case 2:return n.a(2)}}),n)})))()},onShowReply:function(){this.showReplyForReplyFrom=!this.showReplyForReplyFrom},doReply:function(t){var e=this,n=t.content,i=this.$route.params.id,o=this.post.topic_reply_id,s=this.userInfo.id;i&&o&&s?Object(I["q"])(i,o,{content:n,reply_for_user_id:s}).then((function(){e.getCommentList()})).finally((function(){e.showReplyForReplyFrom=!1})):this.$message.error("回复失败：数据不正确"),this.showReplyForReplyFrom=!1},addLike:function(){this.isLike||(this.likeCount++,this.isLike||Object(Z["d"])("community_comment",this.post.id,"likes"),this.isLike=!0)},showAvatar:E["u"]}},yt=bt,wt=(n("275a"),Object(C["a"])(yt,J,Q,!1,null,null,null)),_t=wt.exports,Ct=n("a974"),xt=function(){var t=this,e=t._self._c;return t.allowForward?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onForward()}}},[e("i",{staticClass:"el-icon-document-copy"}),e("span",{staticClass:"u-copy-text__pc"},[t._v(" 复制党+1 ")]),e("span",{staticClass:"u-copy-text__phone"},[t._v("  "),e("strong",[t._v("+1")])])]):t._e()},kt=[],Tt={props:["post","isMaster"],inject:["onReplyTopic"],computed:{isLogin:function(){return y["a"].isLogin()},allowForward:function(){return!this.isMaster&&this.isLogin}},methods:{onForward:function(){this.onReplyTopic({content:this.post.content})}}},St=Tt,Lt=(n("552d"),Object(C["a"])(St,xt,kt,!1,null,"be47b8ce",null)),Mt=Lt.exports,Et=n("a27f"),It=(n("2e26"),n("5a0c")),Ot=n.n(It),At=n("d8ad"),Rt=function(t,e){return Object(m["d"])().get("/api/inspire/article/".concat(t,"/").concat(e,"/history/summary"))},jt=function(t){var e=t.sendUserId,n=t.accessUserId,i=t.postId,o=t.postType;return Object(m["d"])({mute:!0}).get("/api/horn/".concat(e,"/to/user/article/").concat(o,"/").concat(i),{params:{accessUserId:n}})},Ft={name:"ReplyItem",inject:["getTopicData","getReplyList","onReplyTopic"],props:["isMaster","post","isAuthor","nullTip"],components:{DeleteButton:vt,ForwardButton:Mt,ComplaintButton:ut,AddBlockButton:ot,CommentUser:$,ReplyForReply:K,CommentItem:_t,Article:Ct["a"]},provide:function(){var t=this;return{getReplyData:function(){return t.post},getCommentList:this.getList}},data:function(){return{page:1,per:5,total:0,isCollapse:!1,isLike:!1,likeCount:0,showReplyForReplyFrom:!1,renderContent:"",commentList:[],summary:{fromManager:0,fromUser:0},password:""}},computed:{showTime:function(){var t=this.post.created_at||this.post.updated_at;return Ot()(t).format("YYYY-MM-DD HH:mm:ss")},styles:function(){return this.isMaster?{width:"150px",height:"38px"}:{}},id:function(){return this.$route.params.id},onlyAuthor:function(){var t=this.$route.query.onlyAuthor;return(1==t||"true"==t)&&!0},likeCountRender:function(){return this.likeCount>=100?"99+":0!=this.likeCount?this.likeCount:""},userInfo:function(){return this.post&&this.post.user_info?this.post.user_info:this.post&&this.post.ext_user_info?this.post.ext_user_info:{}},userId:function(){return this.post&&this.post.user_info?this.post.user_info.id:this.post&&this.post.ext_user_info?this.post.ext_user_info.id:""},isSuper:function(){return y["a"].isSuperAdmin()},isFollower:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==(null===(e=y["a"].getInfo())||void 0===e?void 0:e.uid)},isLogin:function(){return y["a"].isLogin()},boxCoinTotal:function(){return this.summary.fromManager+this.summary.fromUser},isFromPhone:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.is_from_phone},extraImages:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.extra_images},visible:function(){var t;return!(null===(t=this.post)||void 0===t||!t.visible_validate)}},watch:{"post.content":{handler:function(t){this.isMaster||this.formatContent(t)},immediate:!0},post:{handler:function(){var t=Object(a["a"])(Object(r["a"])().m((function t(){return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(this.commentList=[],!this.post.comments){t.n=2;break}return t.n=1,this.getLikes(this.post.comments);case 1:this.commentList=t.v;case 2:this.post&&this.loadHomeworkBoxcoin();case 3:return t.a(2)}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),immediate:!0},"post.likes":{handler:function(t){this.likeCount=t},immediate:!0}},methods:{onCollapseChange:function(){this.isCollapse?this.commentList=this.post.comments:(this.page=1,this.getList()),this.isCollapse=!this.isCollapse},getSquareBanner:function(t){return t.indexOf("jx3box.com")>=0?Object(E["l"])(t,96):t},authorLink:E["a"],formatContent:function(t){var e=this;return Object(a["a"])(Object(r["a"])().m((function n(){var i,o;return Object(r["a"])().w((function(n){while(1)switch(n.n){case 0:return i=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])(?![^<>]*>)/gi,t=t.replace(i,(function(t,e){return/src="[^"]*"/i.test(t)||-1==t.indexOf("jx3box.com")?t:'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")})),o=new X["a"](t),n.n=1,o._renderHTML();case 1:e.renderContent=n.v;case 2:return n.a(2)}}),n)})))()},onShowReply:function(){this.isMaster?this.$emit("onReplyTopic"):this.showReplyForReplyFrom=!this.showReplyForReplyFrom},doReply:function(t){var e=this,n=t.content,i=this.$route.params.id,o=this.post.id;i&&o&&this.userId?Object(I["q"])(i,o,{content:n,reply_for_user_id:this.userId}).then((function(){e.getList()})).finally((function(){e.showReplyForReplyFrom=!1})):this.$message.error("回复失败：数据不正确")},changePage:function(){this.getList()},getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isMaster){var n=this.id,i=this.post.id;n&&i&&Object(I["g"])(n,i,Object(s["a"])({index:this.page,pageSize:this.per},e)).then(function(){var e=Object(a["a"])(Object(r["a"])().m((function e(n){var i;return Object(r["a"])().w((function(e){while(1)switch(e.n){case 0:if(i=n.data.data.list,!i){e.n=2;break}return e.n=1,t.getLikes(i);case 1:t.commentList=e.v,t.isCollapse=!0,e.n=3;break;case 2:t.commentList=[];case 3:t.page=n.data.data.page.index,t.total=n.data.data.page.total,t.current=n.data.data.page.current;case 4:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}())}},addLike:function(){this.isLike||(this.likeCount++,this.isLike||(this.isMaster?Object(Z["d"])("community_topic",this.post.id,"likes"):Object(Z["d"])("community_reply",this.post.id,"likes")),this.isLike=!0)},getLikes:function(t){return Object(a["a"])(Object(r["a"])().m((function e(){var n,i,o;return Object(r["a"])().w((function(e){while(1)switch(e.n){case 0:return n=t.map((function(t){return"community_comment-".concat(t.id)})).join(","),i=[],o={post_type:"community_comment",post_action:"likes",id:n},e.n=1,Object(Et["b"])(o).then((function(e){i=t.map((function(t){var n;return t.likes=(null===(n=e.data.data["community_comment-".concat(t.id)])||void 0===n?void 0:n.likes)||0,t}))})).catch((function(){i=t}));case 1:return e.a(2,i)}}),e)})))()},onEdit:function(){if(this.isMaster){var t=Object(E["d"])("community",this.post.id);window.open(t,"_blank")}else{var e=Object(E["d"])("community/reply",this.post.id);window.open(e,"_blank")}},onThx:function(){At["a"].emit("onThx",{postType:"community_topic_reply",postId:this.post.id,postUserId:this.userId,client:"std"})},loadHomeworkBoxcoin:function(){var t=this;Rt("community_topic_reply",this.post.id).then((function(e){t.summary=e.data.data}))},onBoxcoinClick:function(){At["a"].emit("boxcoin-click",{postType:"community_topic_reply",postId:this.post.id,postUserId:this.userId})},onFloorClick:function(){var t=this,e=this.post.floor,n=window.location.href.split("#")[0]+"#floor-".concat(e);navigator.clipboard.writeText(n).then((function(){t.$message.success("楼层已复制到剪贴板")}))},enterPwd:function(){this.$emit("enterPwd",this.password)}}},Bt=Ft,Dt=(n("954b"),Object(C["a"])(Bt,l,c,!1,null,null,null)),Pt=Dt.exports,zt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"el-fade-in"}},[t.visible?e("div",{staticClass:"c-toporbottom",style:{right:t.styleRight,bottom:t.styleBottom,zIndex:t.zIndex}},[e("div",{staticClass:"c-toporbottom-top",on:{click:t.scrollToTop}},[e("i",{staticClass:"el-icon-caret-top"})]),e("div",{staticClass:"c-toporbottom-bottom",on:{click:t.scrollToBottom}},[e("i",{staticClass:"el-icon-caret-bottom"})])]):t._e()])},Nt=[],$t=n("0f324"),Ht=n.n($t),Ut=function(t){return Math.pow(t,3)},Wt=function(t){return t<.5?Ut(2*t)/2:1-Ut(2*(1-t))/2},qt={name:"GoToTopOrBottom",props:{visibilityHeight:{type:Number,default:200},right:{type:Number,default:60},bottom:{type:Number,default:100},zIndex:{type:Number,default:999}},data:function(){return{visible:!1}},computed:{styleBottom:function(){return"".concat(this.bottom,"px")},styleRight:function(){return"".concat(this.right,"px")}},mounted:function(){document.addEventListener("scroll",Ht()(this.onScroll,300))},methods:{onScroll:function(){var t=document.documentElement.scrollTop;this.visible=t>=this.visibilityHeight},scrollToTop:function(){this.scrollTo(0)},scrollToBottom:function(){var t=document.documentElement.scrollHeight||document.body.scrollHeight;this.scrollTo(t)},scrollTo:function(t){var e=document.documentElement.scrollTop||document.body.scrollTop,n=t-e,i=500,o=0,s=20,r=function(){o+=s;var t=Wt(o/i);document.documentElement.scrollTop=document.body.scrollTop=e+n*t,o<i&&requestAnimationFrame(r)};r()}},beforeDestroy:function(){document.removeEventListener("scroll",this.throttledScrollHandler)}},Vt=qt,Yt=(n("ed8b"),Object(C["a"])(Vt,zt,Nt,!1,null,null,null)),Kt=Yt.exports,Jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-community-single",attrs:{id:"app"}},[e("Header"),t.post?e("Breadcrumb",{attrs:{name:"魔盒论坛",slug:"community",publishEnable:!1,adminEnable:!0,feedbackEnable:!0,crumbEnable:!0,showExtend:!0},scopedSlots:t._u([{key:"op-prepend",fn:function(){return[t.isTeammate?e("AdminDrop",{attrs:{"is-community":!0,post:t.finalPost,"user-id":t.user_id}}):t._e()]},proxy:!0},{key:"title",fn:function(){return[e("span",[t._v(" "+t._s(t.title)+" ")])]},proxy:!0}],null,!1,3373041507)},[e("TopStickyInfo",{attrs:{post:t.post}}),e("publish-gate",{attrs:{slot:"op-append"},slot:"op-append"})],1):t._e(),e("Main",{attrs:{withoutRight:!1}},[e("div",{staticClass:"m-community-single__main"},[e("div",{staticClass:"m-community-single__left"},[t._t("default"),e("RightSidebar",{attrs:{"show-toggle":!0}},[e("Side",{staticClass:"m-extend",attrs:{id:t.id,type:"community"}})],1),e("Footer")],2)])])],1)},Qt=[],Xt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"slide-fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"m-sticky-info"},[e("h2",{staticClass:"u-title",style:t.hightStyle},[t._v(t._s(t.title))]),e("div",{staticClass:"u-infos"},[t.isTop?e("span",{staticClass:"u-status u-sub-block top"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("rect",{attrs:{width:"24",height:"24",rx:"4",fill:"#FF6969"}}),e("path",{attrs:{d:"M5.654 10.916l7.671 7.94s4.819-9.49 7.194-9.003c2.376.488-6.481-9.125-5.852-6.28.63 2.845-9.013 7.343-9.013 7.343z",fill:"#FFF"}}),e("path",{attrs:{d:"M4.114 9.325L14.852 20.44l-1.055-5.26-4.602-4.763-5.081-1.092zM3.09 20.808l7.06-5.225L8.137 13.5l-5.048 7.309z",fill:"#FFF"}})])]):t._e(),t.isStar?e("span",{staticClass:"u-status u-sub-block star"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 15 15",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M15 7.5L9.515 5.485 7.5 0 5.485 5.485 0 7.5l5.485 2.015L7.5 15l2.015-5.485L15 7.5z",fill:"#FFF"}})])]):t._e(),t._l(t.tags,(function(n,i){return e("span",{key:i,staticClass:"u-tag u-meta u-sub-block",style:{backgroundColor:n.color}},[t._v(" "+t._s(n.label)+" ")])})),t.collection?e("a",{staticClass:"u-book u-sub-block u-meta",attrs:{href:t.collection.url,target:"_blank"}},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"16",viewBox:"0 0 11 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#A6A6A6",d:"M5.5 12.1L0 16V0h11v16l-5.5-3.9z"}})]),t._v(" "+t._s(t.collection.name)+" ")]):t._e()],2)])])},Zt=[],Gt={props:["post"],data:function(){return{show:!1}},computed:{hightStyle:function(){return this.post.is_hight&&this.post.hight_color?{color:this.post.hight_color}:{}},collection:function(){return this.post.collection&&this.post.collection.title?{name:this.post.collection.title,url:"/collection/".concat(this.post.collection_id)}:null},tags:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.color_tag},isStar:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.is_star},isTop:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.is_top)||(null===(e=this.post)||void 0===e?void 0:e.is_category_top)},title:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.title)||"无标题"}},mounted:function(){document.addEventListener("scroll",this.handleScroll)},beforeDestroy:function(){document.removeEventListener("scroll",this.handleScroll)},methods:{handleScroll:function(){var t=document.getElementsByClassName("m-single-header");if(t.length){var e=t[0].getBoundingClientRect();document.documentElement.scrollTop>e.y+e.height?this.show=!0:this.show=!1}}}},te=Gt,ee=(n("8ba2"),Object(C["a"])(te,Xt,Zt,!1,null,"331c1f91",null)),ne=ee.exports,ie=n("98e8"),oe=n("f175"),se=n("ac7a"),re={"求助":"newbie","萌新":"newbie","讨论":"discussion","警示":"discussion","墨香":"poem","日记":"poem","三次元":"poem","美图":"pvx","同人":"pvx","心得":"wiki","剧情":"wiki"},ae={name:"CommunitySingleLayout",props:["post"],data:function(){return{id:Object(E["f"])()}},computed:{isTeammate:function(){return y["a"].isTeammate()},user_id:function(){return this.post?this.post.user_id:""},title:function(){return this.post?this.post.title:document.title},finalPost:function(){var t,e;return Object(s["a"])(Object(s["a"])({},this.post),{},{post_title:this.post.title,ID:this.post.id,post_type:"community",_subtype:this.subtype,author:null===(t=this.post)||void 0===t||null===(e=t.ext_user_info)||void 0===e?void 0:e.display_name})},subtype:function(){return re[this.post.category]}},mounted:function(){},methods:{getAppIcon:E["g"]},components:{"publish-gate":ie["a"],AdminDrop:oe["a"],TopStickyInfo:ne,Side:se["a"]}},le=ae,ce=(n("2da0"),Object(C["a"])(le,Jt,Qt,!1,null,null,null)),ue=ce.exports,de=function(){var t=this,e=t._self._c;return t.post?e("header",{staticClass:"m-single-header"},[e("div",{staticClass:"m-single-title"},[e("span",{staticClass:"u-title u-sub-block"},[t._t("title_before"),t.styles?e("div",{staticClass:"m-topic-category-box"},[e("a",{class:"m-topic-category",style:"background-color: ".concat(t.styles.hoverColor,";color:").concat(t.styles.color,";"),attrs:{href:"/community?category=".concat(t.post.category)}},[e("img",{directives:[{name:"svg-inline",rawName:"v-svg-inline"}],staticClass:"u-icon",attrs:{src:n("1c2f")("./".concat(t.styles.icon,".svg"))}}),e("div",[t._v(t._s(t.post.category))])])]):t._e(),"publish"!=t.post.post_status||~~t.post.visible?e("i",{staticClass:"u-private"},["draft"==t.post.post_status||"pending"==t.post.post_status||~~t.post.visible?e("i",{staticClass:"el-icon-lock",staticStyle:{color:"#fb9b24"}}):t._e(),"dustbin"==t.post.post_status?e("i",{staticClass:"el-icon-delete",staticStyle:{color:"#c00"}}):t._e()]):t._e(),e("span",{staticClass:"u-title-text",style:t.hightStyle},[t._v(t._s(t.title))]),e("div",{staticClass:"u-title-toolbar"},[t.isPostOwner?e("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit"},on:{click:t.onEditClick}},[t._v("编辑")]):t._e(),e("el-button",{class:"u-only-btn ".concat(t.onlyAuthor&&"u-unset"),attrs:{size:"small",type:"primary"},on:{click:function(e){return t.setOnlyAuthor(!t.onlyAuthor)}}},[e("svg",{directives:[{name:"show",rawName:"v-show",value:!t.onlyAuthor,expression:"!onlyAuthor"}],attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M8 .667c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zM8 2a2.666 2.666 0 110 5.333A2.666 2.666 0 118 2zm6 9.333v-.666a2 2 0 00-4 0v.666h-.667v3.334h5.333v-3.334H14zM2.667 14.667H4a4 4 0 014-4V9.333a5.333 5.333 0 00-5.333 5.334zM12 10c.368 0 .666.299.666.667v.666h-1.333v-.666c0-.368.299-.667.667-.667z"}})]),t._v(" "+t._s(t.onlyAuthor?"取消只看楼主":"只看楼主")+" ")])],1)],2)]),e("div",{staticClass:"m-single-info"},[t._t("default"),t.isTop?e("span",{staticClass:"u-status u-sub-block top"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("rect",{attrs:{width:"24",height:"24",rx:"4",fill:"#FF6969"}}),e("path",{attrs:{d:"M5.654 10.916l7.671 7.94s4.819-9.49 7.194-9.003c2.376.488-6.481-9.125-5.852-6.28.63 2.845-9.013 7.343-9.013 7.343z",fill:"#FFF"}}),e("path",{attrs:{d:"M4.114 9.325L14.852 20.44l-1.055-5.26-4.602-4.763-5.081-1.092zM3.09 20.808l7.06-5.225L8.137 13.5l-5.048 7.309z",fill:"#FFF"}})]),t._v(" 置顶 ")]):t._e(),t.isStar?e("span",{staticClass:"u-status u-sub-block star"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 15 15",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M15 7.5L9.515 5.485 7.5 0 5.485 5.485 0 7.5l5.485 2.015L7.5 15l2.015-5.485L15 7.5z",fill:"#FFF"}})]),t._v(" 精选 ")]):t._e(),t._l(t.tags,(function(n,i){return e("span",{key:i,staticClass:"u-tag u-sub-block",style:{backgroundColor:n.color}},[t._v(" "+t._s(n.label)+" ")])})),e("span",{staticClass:"u-sub-block",attrs:{title:"发布日期:"+t.post_time}},[e("i",{staticClass:"u-icon-podate"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"#6a737d",viewBox:"0 0 485.2 485.2","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M60.7 75.8V15.2C60.7 6.8 67.4 0 75.8 0 84.2 0 91 6.8 91 15.2v60.7C91 84.2 84.2 91 75.8 91c-8.4 0-15.1-6.8-15.1-15.2zM318.4 91c8.4 0 15.2-6.8 15.2-15.2V15.2c0-8.4-6.8-15.2-15.2-15.2-8.4 0-15.2 6.8-15.2 15.2v60.7c.1 8.3 6.8 15.1 15.2 15.1zM60.7 182h60.7v60.7H60.7zM60.7 272.9h60.7v60.7H60.7zM151.6 182h60.7v60.7h-60.7zM151.6 272.9h60.7v60.7h-60.7z"}}),e("path",{attrs:{d:"M30 361.2v-210h334c.2 70.7.4 141.4.7 212.1 9.8 0 19.6-.1 29.3-.1V93.6c0-18.5-14.5-33.4-32.5-33.4H349v15.2c0 16.7-13.7 30.3-30.5 30.3S288 92.1 288 75.4V60.2H106v15.2c0 16.7-13.7 30.3-30.5 30.3S45 92.1 45 75.4V60.2H32.5c-18 0-32.5 15-32.5 33.4v267.2c0 9.2 3.6 17.5 9.5 23.6 7.8 8.1 18.5 9.3 23 9.8 22.1 2.4 165.3 2.9 361.5 1v-32c-120.5.3-241 .7-361.5 1-.8-1-1.7-2-2.5-3z"}}),e("path",{attrs:{d:"M242.6 182h60.6v60.7h-60.6zM242.6 272.9h60.7v60.7h-60.7z"}})])]),e("time",[t._v(t._s(t.post_date))])]),e("span",{staticClass:"u-views u-sub-block"},[e("i",{staticClass:"el-icon-view"}),t._v(" "+t._s(t.views)+" ")]),t.wordCount?e("span",{staticClass:"u-word-count u-sub-block",attrs:{title:"累计字数"}},[e("i",{staticClass:"el-icon-sunny"}),t._v(" "+t._s(t.wordCount)+" ")]):t._e(),t._t("append")],2),e("div",{staticClass:"u-title-toolbar u-phone-show"},[t.isPostOwner?e("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit"},on:{click:t.onEditClick}},[t._v("编辑")]):t._e(),e("el-button",{class:"u-only-btn ".concat(t.onlyAuthor&&"u-unset"),attrs:{size:"small",type:"primary"},on:{click:function(e){return t.setOnlyAuthor(!t.onlyAuthor)}}},[e("svg",{directives:[{name:"show",rawName:"v-show",value:!t.onlyAuthor,expression:"!onlyAuthor"}],attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M8 .667c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zM8 2a2.666 2.666 0 110 5.333A2.666 2.666 0 118 2zm6 9.333v-.666a2 2 0 00-4 0v.666h-.667v3.334h5.333v-3.334H14zM2.667 14.667H4a4 4 0 014-4V9.333a5.333 5.333 0 00-5.333 5.334zM12 10c.368 0 .666.299.666.667v.666h-1.333v-.666c0-.368.299-.667.667-.667z"}})]),t._v(" "+t._s(t.onlyAuthor?"取消只看楼主":"只看楼主")+" ")])],1)]):t._e()},pe=[],he=n("e4f1"),fe=n("1157"),me=n.n(fe),ve=n("6f4a"),ge={name:"single-header",props:["post","stat"],inject:["setOnlyAuthor"],data:function(){return{categoryList:[],wordCount:0}},computed:{hightStyle:function(){return this.post.is_hight&&this.post.hight_color?{color:this.post.hight_color}:{}},onlyAuthor:function(){var t=this.$route.query.onlyAuthor;return(1==t||"true"==t)&&!0},isPostOwner:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==(null===(e=y["a"].getInfo())||void 0===e?void 0:e.uid)},collection:function(){return this.post.collection&&this.post.collection.title?{name:this.post.collection.title,url:"/collection/".concat(this.post.collection_id)}:null},tags:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.color_tag)||[]},isStar:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.is_star},isTop:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.is_top)||(null===(e=this.post)||void 0===e?void 0:e.is_category_top)},title:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.title)||"无标题"},post_date:function(){var t;return Object(he["a"])(new Date(null===(t=this.post)||void 0===t?void 0:t.created_at))},update_date:function(){var t;return Object(he["a"])(new Date(null===(t=this.post)||void 0===t?void 0:t.updated_at))},post_time:function(){var t;return Object(he["b"])(new Date(null===(t=this.post)||void 0===t?void 0:t.created_at))},update_time:function(){var t;return Object(he["b"])(new Date(null===(t=this.post)||void 0===t?void 0:t.updated_at))},views:function(){var t;return(null===(t=this.stat)||void 0===t?void 0:t.views)||"-"},edit_link:function(){var t,e;return Object(E["d"])(null===(t=this.post)||void 0===t?void 0:t.post_type,null===(e=this.post)||void 0===e?void 0:e.ID)},canEdit:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==y["a"].getInfo().uid||y["a"].isEditor()},styles:function(){var t=this,e=this.categoryList.find((function(e){return e.value===t.post.category}));return e||null}},watch:{post:{deep:!0,handler:function(t){this.countWords()}}},methods:{showClientLabel:function(t){return B["__clients"][t]},countWords:function(){var t=this;this.$nextTick((function(){var e,n=null===(e=me()(".c-article").text())||void 0===e?void 0:e.replace(/[\s|\n|\r|\t|\g|\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\，|\。|\？|\：|\；|\‘|\’|\”|\“|\、|\·|\！|\（|\）|\》|\《|\『|\』]/g,"");t.wordCount=(null===n||void 0===n?void 0:n.length)||0}))},getCategoryList:function(){var t=this;Object(F["c"])({type:"community",search:this.post.category}).then((function(e){t.categoryList=Object(ve["a"])(e.data.data)}))},onEditClick:function(){var t;window.location.href=Object(E["d"])("community",null===(t=this.post)||void 0===t?void 0:t.id)}},mounted:function(){this.getCategoryList()}},be=ge,ye=(n("0e46"),Object(C["a"])(be,de,pe,!1,null,null,null)),we=ye.exports,_e=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-box m-comment-reply",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{ref:"textarea",staticClass:"u-comment-editor",attrs:{rows:"6",type:"textarea",maxlength:t.maxLength,"show-word-limit":"",placeholder:"参与讨论...",id:t.inputId},nativeOn:{paste:function(e){return t.handlePaste.apply(null,arguments)},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.handleDel.apply(null,arguments)}},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),e("div",{staticClass:"c-comment-tools"},[e("div",{staticClass:"u-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}}),e("quickReply",{on:{reply:t.onQuickReply}})],1)]),e("div",{staticClass:"u-toolbar"},[e("el-button",{staticClass:"u-publish",attrs:{type:"primary",disabled:t.disableSubmitBtn},on:{click:t.onSubmit}},[t._v(" 跟帖 ")])],1),e("Uploader",{directives:[{name:"show",rawName:"v-show",value:t.showUploader,expression:"showUploader"}],ref:"uploader",staticClass:"u-uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}})],1)],1)},Ce=[],xe=(n("4de4"),n("13d5"),n("fb6a"),n("910d"),n("7d54"),n("9485"),n("a732"),n("4d63"),n("c607"),n("2c3e"),n("25f0"),n("159b"),function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:t.url,"list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:t.maxCount,accept:t.acceptedExtensions.reduce((function(t,e){return t+".".concat(e,",")}),""),multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 最多上传 "+t._s(t.maxCount)+" 张 "+t._s(t.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+t._s(t.maxSize/1024/1024)+" MB ")])]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)}),ke=[],Te=B["__cms"],Se=Te+"api/cms/upload",Le={data:function(){return{url:Se,dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:10485760}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"最多上传 ".concat(this.maxCount," 张图片！"),type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>this.maxSize?(this.$notify({title:"",message:"单张图片大小不能超过 ".concat(this.maxSize/1024/1024," MB！"),type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data),0===t.code?this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[]):this.onError(t.msg)},onError:function(t){this.$notify({title:"",message:t||"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]},addFile:function(t){return this.$refs.upload.handleStart(t),!1}}},Me=Le,Ee=Object(C["a"])(Me,xe,ke,!1,null,null,null),Ie=Ee.exports,Oe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-jx3box-reply"},[e("el-popover",{ref:"quickReply",attrs:{"visible-arrow":!0,placement:"top",trigger:"click","popper-class":"c-jx3box-reply-pop"}},[e("div",{staticClass:"c-jx3box-reply-pop__content"},[e("i",{staticClass:"el-icon-close u-close",on:{click:t.closePop}}),e("div",{staticClass:"u-title"},[t._v("快捷回复")]),e("div",{staticClass:"m-reply-list"},t._l(t.replyTemplate,(function(n,i){return e("div",{key:i,staticClass:"m-reply-list__item",on:{click:function(e){return t.reply(n)}}},[t._v(" "+t._s(n)+" ")])})),0)]),e("img",{staticClass:"u-reference",attrs:{slot:"reference",width:"24",height:"24",src:n("9c54"),alt:"comment"},slot:"reference"})])],1)},Ae=[],Re={name:"QuickReply",data:function(){return{replyTemplate:["真不错，谢谢楼主#胜利#笨猪#胜利","辛苦了，感谢楼主的付出","谢谢楼主，很有用","剑三真好玩，魔盒真好用"]}},emits:["reply"],methods:{closePop:function(){this.$refs.quickReply&&this.$refs.quickReply.doClose()},reply:function(t){this.$emit("reply",t),this.closePop()}}},je=Re,Fe=(n("e934"),Object(C["a"])(je,Oe,Ae,!1,null,"1bb1d831",null)),Be=Fe.exports,De=n("e0a1"),Pe=n.n(De),ze=n("2ef0"),Ne={name:"CommentInputForm",components:{Uploader:Ie,Emotion:W["a"],quickReply:Be},props:{isBottom:{type:Boolean,default:!1}},mounted:function(){this.isBottom&&(this.inputId="textarea-bottom"),this.initTribute()},data:function(){return{selectedMentions:[],tribute:{trigger:"@",values:[]},maxLength:500,showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top",is_secret:!1}},methods:{initTribute:function(){var t=this,e=this.$refs.textarea.$el.querySelector("textarea");this.tribute=new Pe.a({trigger:"@",requireLeadingSpace:!1,lookup:"display_name",fillAttr:"display_name",menuItemLimit:5,values:Object(ze["throttle"])((function(t,e){if(""==t)return e([]);Object(F["d"])({name:t}).then((function(t){var n,i=(null===(n=t.data.data)||void 0===n?void 0:n.list)||[];return e(i)}))}),1e3),loadingItemTemplate:"<div>Loading...</div>",selectTemplate:function(e){return t.selectedMentions.push(e.original),"@"+e.original.display_name},menuItemTemplate:function(t){var e=t.original.user_avatar||"https://img.jx3box.com/image/common/avatar.png";return'\n                        <img src="'.concat(e,'" alt="Avatar" style="width: 20px; height: 20px; border-radius: 50%;">\n                        <span>').concat(t.original.display_name,"</span>\n                        ")},noMatchTemplate:function(){return"<li>请输入用户昵称</li>"}}),this.tribute.attach(e)},handleDel:function(t){var e=t.target.value.slice(0,-1),n=/@([\s\S]+)?$/,i=n.test(e);if(i){var o=this.$refs.textarea.$el.querySelector("textarea"),s=new KeyboardEvent("keydown",{key:"Meta",code:"MetaLeft",keyCode:91,which:91,bubbles:!0});o.dispatchEvent(s)}},onSubmit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},onQuickReply:function(t){this.$emit("submit",{content:t,attachmentList:[],is_template:1})},attachmentUploadFinish:function(t){var e,n=null===(e=this.newComment.content)||void 0===e?void 0:e.replace(/\n/g,"<br>"),i=this.selectedMentions.reduce((function(t,e){return t.some((function(t){return t.ID===e.ID}))||t.push(e),t}),[]);i=i.filter((function(t){return n.indexOf(t.display_name+" ")>-1})),i.forEach((function(t){n=n.replace(new RegExp("@"+t.display_name+" ","g"),'<a class="e-jx3-author w-jx3-element" href="/author/'.concat(t.ID,'"  target="_blank" rel="noopener" data-type="author"  data-mode="" data-id="').concat(t.ID,'">@').concat(t.display_name," </a>"))})),this.$emit("submit",{content:n,is_secret:this.is_secret?1:0,attachmentList:t,atUsers:i}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){this.insertVariable(t)},insertVariable:function(t){var e=this;return Object(a["a"])(Object(r["a"])().m((function n(){var i,o,s,a;return Object(r["a"])().w((function(n){while(1)switch(n.n){case 0:if(i=e.$refs.textarea.$el.querySelector("textarea"),o=t.key,!i.selectionStart&&0!==i.selectionStart){n.n=2;break}return s=i.selectionStart,a=i.selectionEnd,e.newComment.content=i.value.substring(0,s)+o+i.value.substring(a,i.value.length),n.n=1,e.$nextTick();case 1:i.focus(),i.setSelectionRange(a+o.length,a+o.length),n.n=3;break;case 2:e.newComment.content=o;case 3:return n.a(2)}}),n)})))()},handlePaste:function(t){for(var e=t.clipboardData.items,n=0;n<e.length;n++){var i=e[n];if(-1!==i.type.indexOf("image")){t.preventDefault();var o=i.getAsFile(),s=new File([o],(new Date).getTime()+"-"+o.name,{type:o.type});this.$refs.uploader.addFile(s),this.showUploader||(this.showUploader=!0)}}}}},$e=Ne,He=(n("54eb0"),Object(C["a"])($e,_e,Ce,!1,null,null,null)),Ue=He.exports,We=n("cad9"),qe=n("6bce"),Ve=n("18e2"),Ye=n("1f89"),Ke=n("fe89"),Je="community",Qe={components:{CommentEditor:Ue,CommunitySingleLayout:ue,PostHeader:we,ReplyItem:Pt,Homework:We["a"],boxCoinRecords:qe["a"],GoToTopOrBottom:Kt,Collection:Ve["a"],"jx3-author":Ke["a"]},provide:function(){var t=this;return{getTopicData:function(){return t.post},getReplyList:this.getReplyList,setOnlyAuthor:this.setOnlyAuthor,onReplyTopic:this.onReplyTopic,onSearch:this.onSearch}},data:function(){return{floor:0,stat:"",page:1,per:10,total:0,pageTotal:0,post:{},replyList:[],categoryList:[],loading:!1,onlyAuthor:!1,number_queries:["per","page"],mode:null,showHomeWork:!1,postType:"community",postId:"",postUserId:0,postClient:"std",showBoxCoin:!1,showComment:!1,collection_data:"",jx3_element:{style:{top:0,left:0,display:"block"},type:""},author:{id:""},password:""}},computed:{styles:function(){var t=this,e=this.categoryList.find((function(e){return e.value===t.post.category}));return e||{icon:"game",hoverColor:"rgba(235, 244, 255, 1)",color:"rgba(64, 128, 255, 1)"}},id:function(){return this.$route.params.id},isAuthor:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==y["a"].getInfo().uid},isPhone:function(){return window.innerWidth<768},hasNextPage:function(){return this.pageTotal>=1&&this.per*this.page<this.total},collection_id:function(){return this.post.collection_id},collection_collapse:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.collection_collapse},null_tip:function(){var t,e="作者设置了【";return e+=B["__visibleMap"][null===(t=this.post)||void 0===t?void 0:t.visible],e+="】",e},visible:function(){var t;return!(null===(t=this.post)||void 0===t||!t.visible_validate)}},created:function(){this.getJumpFloor()},mounted:function(){var t=this;if(!this.id)return this.$message.error("文章id不存在");this.getDetails(),this.getReplyList().then((function(){t.$nextTick((function(){Object(Ye["a"])(t)}))})),At["a"].on("onThx",(function(e){t.postType=e.postType,t.postId=e.postId,t.postUserId=e.postUserId,t.showHomeWork=!0})),At["a"].on("boxcoin-click",(function(e){t.postType=e.postType,t.postId=e.postId,t.showBoxCoin=!0}))},watch:{"$route.query":{deep:!0,immediate:!0,handler:function(t){if(Object.keys(t).length)for(var e in t)this.number_queries.includes(e)?this[e]=~~t[e]:this[e]=t[e]}}},methods:{getJumpFloor:function(){var t=window.location.hash,e=t.substring(1).split("?")[0];e&&(this.floor=e,this.page=Math.ceil((e-1)/this.per))},jumpFloor:function(t){var e=t||this.floor;this.$nextTick((function(){var t=document.getElementById("floor-"+e);t&&(t.scrollIntoView(),window.scrollBy(0,-120))}))},nextPage:function(){this.getReplyList(!0)},onSearch:function(){var t=this;this.page=1,this.$nextTick((function(){t.getReplyList()}))},setOnlyAuthor:function(t){this.page=1,this.onlyAuthor=t,this.getReplyList()},buildQuery:function(){var t={index:this.page,pageSize:this.per,order_created_at:0};return!this.onlyAuthor||1!=this.onlyAuthor&&"true"!=this.onlyAuthor||(t.user_id=this.post.user_id),this.replaceRoute({page:this.page,onlyAuthor:this.onlyAuthor}),t},getTopicData:function(){return this.post},getDetails:function(){var t=this,e=I["j"];"admin"==this.mode&&(e=I["k"]);var n={};this.password&&(n.password=this.password),e(this.id,n).then((function(e){t.post=e.data.data,Object(Z["a"])(Je,t.id).then((function(e){t.stat=e.data,t.$set(t.post,"likes",t.stat.likes||0)})),Object(Z["d"])(Je,t.id),y["a"].isLogin()&&(Object(Z["b"])({source_type:"community",source_id:~~t.id,link:location.href,title:t.post.title,author_id:t.post.user_id,banner:t.post.banner_img,content_meta_id:t.post.link_content_meta_id}),t.post.visible>1&&t.post.visible_validate&&Object(Z["c"])({id:t.id,category:"communicate",subcategory:"default",visible_type:~~t.post.visible,author_id:t.post.user_id,banner:t.post.banner_img,contentMetaId:t.post.link_content_meta_id}))}))},getReplyList:function(t){var e=this;if("admin"!=this.mode){this.loading=!0,t&&(this.page+=1);var n=this.buildQuery();return Object(I["m"])(this.id,n).then(function(){var t=Object(a["a"])(Object(r["a"])().m((function t(n){var i,o;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(i=n.data.data.list,o=n.data.data.page,null!=i){t.n=1;break}e.replyList=[],t.n=3;break;case 1:return t.n=2,e.getLikes(i);case 2:i=t.v,e.replyList=i,e.floor&&e.jumpFloor();case 3:e.total=o.total,e.pageTotal=o.pageTotal,e.$nextTick((function(){e.page=o.index}));case 4:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}()).finally((function(){e.loading=!1}))}},getLikes:function(t){return Object(a["a"])(Object(r["a"])().m((function e(){var n,i,o;return Object(r["a"])().w((function(e){while(1)switch(e.n){case 0:return n=t.map((function(t){return"community_reply-".concat(t.id)})),i=n.join(","),o=[],e.n=1,Object(Et["b"])({post_type:"community_reply",post_action:"likes",id:i}).then((function(e){o=t.map((function(t){var n;return t.likes=(null===(n=e.data.data["community_reply-".concat(t.id)])||void 0===n?void 0:n.likes)||0,t}))})).catch((function(){o=t}));case 1:return e.a(2,o)}}),e)})))()},onReplyTopic:function(t){var e=this,n=t.attachmentList,i=t.content,o=t.atUsers;if(!this.id)return this.$message.error("文章id不存在");if(n&&n.length){var s=n.map((function(t){return"<p><img class='attachment' src=\"".concat(t,'" /></p>')})).join("");i+=s}Object(I["r"])(this.id,{client:location.href.includes("origin")?"origin":"std",content:i}).then((function(t){e.onReplyTopicSuccess(t.data.data),e.showComment=!1,e.noticeMentionsUser(o)}))},noticeMentionsUser:function(t){var e=t.map((function(t){return t.ID})),n=y["a"].getInfo();jt({sendUserId:n.uid,accessUserId:e.join(","),postId:this.id,postType:"community"})},onReplyTopicSuccess:function(t){var e=this;if(this.replyList.length+1<=this.per){var n=y["a"].getInfo();this.replyList.push(Object(s["a"])(Object(s["a"])({},t),{},{user_info:{id:Number(n.uid),display_name:n.name,avatar:n.avatar}})),this.$nextTick((function(){window.scrollTo(0,document.body.scrollHeight)}))}else this.total=this.total+1,this.page=Math.ceil((this.total+1)/this.per),this.$nextTick((function(){e.getReplyList().finally((function(){window.scrollTo(0,document.body.scrollHeight)}))}))},changePage:function(t){this.page=t,this.getReplyList()},replaceRoute:function(t){return this.$router.push({name:this.$route.name,query:Object.assign({},this.$route.query,t)}).then((function(){window.scrollTo(0,0)})).catch((function(t){}))},handleReplyTopic:function(){this.showComment=!0},updateCollection:function(t){this.collection_data=t},enterPwd:function(t){this.password=t,this.getDetails()}}},Xe=Qe,Ze=(n("6a51a"),Object(C["a"])(Xe,i,o,!1,null,null,null));e["default"]=Ze.exports},"033e":function(t,e,n){},"076f":function(t,e,n){t.exports=n.p+"img/reply.7dfa9d81.svg"},"0e46":function(t,e,n){"use strict";n("1009")},"0f324":function(t,e,n){var i=n("b047c"),o=n("1a8c"),s="Expected a function";function r(t,e,n){var r=!0,a=!0;if("function"!=typeof t)throw new TypeError(s);return o(n)&&(r="leading"in n?!!n.leading:r,a="trailing"in n?!!n.trailing:a),i(t,e,{leading:r,maxWait:e,trailing:a})}t.exports=r},1009:function(t,e,n){},"11e6":function(t,e,n){},1310:function(t,e){function n(t){return null!=t&&"object"==typeof t}t.exports=n},"1a8c":function(t,e){function n(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=n},"1f2b":function(t,e,n){},2486:function(t,e,n){"use strict";n("37f6")},"275a":function(t,e,n){"use strict";n("43fb")},"28cf":function(t,e,n){},"29f3":function(t,e){var n=Object.prototype,i=n.toString;function o(t){return i.call(t)}t.exports=o},"2b3e":function(t,e,n){var i=n("585a"),o="object"==typeof self&&self&&self.Object===Object&&self,s=i||o||Function("return this")();t.exports=s},"2da0":function(t,e,n){"use strict";n("9572")},"2ed4":function(t,e,n){"use strict";n("f78f")},3729:function(t,e,n){var i=n("9e69"),o=n("00fd"),s=n("29f3"),r="[object Null]",a="[object Undefined]",l=i?i.toStringTag:void 0;function c(t){return null==t?void 0===t?a:r:l&&l in Object(t)?o(t):s(t)}t.exports=c},"37f6":function(t,e,n){},"408c":function(t,e,n){var i=n("2b3e"),o=function(){return i.Date.now()};t.exports=o},"43fb":function(t,e,n){},"4a11":function(t,e,n){t.exports=n.p+"img/praise.f6d89055.svg"},"4cef":function(t,e){var n=/\s/;function i(t){var e=t.length;while(e--&&n.test(t.charAt(e)));return e}t.exports=i},"54eb0":function(t,e,n){"use strict";n("11e6")},"552d":function(t,e,n){"use strict";n("9a47")},"585a":function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n("c8ba"))},"69a6":function(t,e,n){},"6a51a":function(t,e,n){"use strict";n("a2f5")},8372:function(t,e,n){"use strict";n("fd35")},"8b3c":function(t,e,n){t.exports=n.p+"img/thx.df357374.webp"},"8ba2":function(t,e,n){"use strict";n("1f2b")},"8d74":function(t,e,n){var i=n("4cef"),o=/^\s+/;function s(t){return t?t.slice(0,i(t)+1).replace(o,""):t}t.exports=s},"954b":function(t,e,n){"use strict";n("28cf")},9572:function(t,e,n){},"96ba":function(t,e,n){"use strict";n("033e")},"9a47":function(t,e,n){},"9c54":function(t,e,n){t.exports=n.p+"img/comment.2840ad61.svg"},"9e69":function(t,e,n){var i=n("2b3e"),o=i.Symbol;t.exports=o},a27f:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var i=n("41cb");function o(t){return Object(i["b"])().get("/api/summary/batch",{params:t})}function s(t){return Object(i["b"])().get("/api/next2/users/birthday/today",{params:t})}},a2f5:function(t,e,n){},a732:function(t,e,n){"use strict";var i=n("23e7"),o=n("c65b"),s=n("2266"),r=n("59ed"),a=n("825a"),l=n("46c4"),c=n("2a62"),u=n("f99f"),d=u("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(t){a(this);try{r(t)}catch(i){c(this,"throw",i)}if(d)return o(d,this,t);var e=l(this),n=0;return s(e,(function(e,i){if(t(e,n++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},b047c:function(t,e,n){var i=n("1a8c"),o=n("408c"),s=n("b4b0"),r="Expected a function",a=Math.max,l=Math.min;function c(t,e,n){var c,u,d,p,h,f,m=0,v=!1,g=!1,b=!0;if("function"!=typeof t)throw new TypeError(r);function y(e){var n=c,i=u;return c=u=void 0,m=e,p=t.apply(i,n),p}function w(t){return m=t,h=setTimeout(x,e),v?y(t):p}function _(t){var n=t-f,i=t-m,o=e-n;return g?l(o,d-i):o}function C(t){var n=t-f,i=t-m;return void 0===f||n>=e||n<0||g&&i>=d}function x(){var t=o();if(C(t))return k(t);h=setTimeout(x,_(t))}function k(t){return h=void 0,b&&c?y(t):(c=u=void 0,p)}function T(){void 0!==h&&clearTimeout(h),m=0,c=f=u=h=void 0}function S(){return void 0===h?p:k(o())}function L(){var t=o(),n=C(t);if(c=arguments,u=this,f=t,n){if(void 0===h)return w(f);if(g)return clearTimeout(h),h=setTimeout(x,e),y(f)}return void 0===h&&(h=setTimeout(x,e)),p}return e=s(e)||0,i(n)&&(v=!!n.leading,g="maxWait"in n,d=g?a(s(n.maxWait)||0,e):d,b="trailing"in n?!!n.trailing:b),L.cancel=T,L.flush=S,L}t.exports=c},b4b0:function(t,e,n){var i=n("8d74"),o=n("1a8c"),s=n("ffd6"),r=NaN,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;function d(t){if("number"==typeof t)return t;if(s(t))return r;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=i(t);var n=l.test(t);return n||c.test(t)?u(t.slice(2),n?2:8):a.test(t)?r:+t}t.exports=d},c402:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return r}));var i=n("41cb");n("65c2");function o(t){return Object(i["a"])().get("/api/cms/topic/bucket",{params:t})}var s=function(t){return Object(i["a"])().get("api/cms/config/banner",{params:t})};function r(t){return Object(i["a"])().get("/api/cms/user/decoration",{params:t})}var a=function(t){return Object(i["a"])().get("/api/cms/user/list",{params:t})}},e0a1:function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){o=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}if(Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),i=n.length>>>0,o=arguments[1],s=0;s<i;s++)if(e=n[s],t.call(o,e,s,n))return e}),window&&"function"!=typeof window.CustomEvent){var o=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};void 0!==window.Event&&(o.prototype=window.Event.prototype),window.CustomEvent=o}var s=function(){function e(n){t(this,e),this.tribute=n,this.tribute.events=this}return n(e,[{key:"bind",value:function(t){t.boundKeydown=this.keydown.bind(t,this),t.boundKeyup=this.keyup.bind(t,this),t.boundInput=this.input.bind(t,this),t.addEventListener("keydown",t.boundKeydown,!1),t.addEventListener("keyup",t.boundKeyup,!1),t.addEventListener("input",t.boundInput,!1)}},{key:"unbind",value:function(t){t.removeEventListener("keydown",t.boundKeydown,!1),t.removeEventListener("keyup",t.boundKeyup,!1),t.removeEventListener("input",t.boundInput,!1),delete t.boundKeydown,delete t.boundKeyup,delete t.boundInput}},{key:"keydown",value:function(t,n){t.shouldDeactivate(n)&&(t.tribute.isActive=!1,t.tribute.hideMenu());var i=this;t.commandEvent=!1,e.keys().forEach((function(e){e.key===n.keyCode&&(t.commandEvent=!0,t.callbacks()[e.value.toLowerCase()](n,i))}))}},{key:"input",value:function(t,e){t.inputEvent=!0,t.keyup.call(this,t,e)}},{key:"click",value:function(t,e){var n=t.tribute;if(n.menu&&n.menu.contains(e.target)){var i=e.target;for(e.preventDefault(),e.stopPropagation();"li"!==i.nodeName.toLowerCase();)if(!(i=i.parentNode)||i===n.menu)throw new Error("cannot find the <li> container for the click");n.selectItemAtIndex(i.getAttribute("data-index"),e),n.hideMenu()}else n.current.element&&!n.current.externalTrigger&&(n.current.externalTrigger=!1,setTimeout((function(){return n.hideMenu()})))}},{key:"keyup",value:function(t,e){if(t.inputEvent&&(t.inputEvent=!1),t.updateSelection(this),27!==e.keyCode){if(!t.tribute.allowSpaces&&t.tribute.hasTrailingSpace)return t.tribute.hasTrailingSpace=!1,t.commandEvent=!0,void t.callbacks().space(e,this);if(!t.tribute.isActive)if(t.tribute.autocompleteMode)t.callbacks().triggerChar(e,this,"");else{var n=t.getKeyCode(t,this,e);if(isNaN(n)||!n)return;var i=t.tribute.triggers().find((function(t){return t.charCodeAt(0)===n}));void 0!==i&&t.callbacks().triggerChar(e,this,i)}t.tribute.current.mentionText.length<t.tribute.current.collection.menuShowMinLength||((t.tribute.current.trigger||t.tribute.autocompleteMode)&&!1===t.commandEvent||t.tribute.isActive&&8===e.keyCode)&&t.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(t){if(!this.tribute.isActive)return!1;if(0===this.tribute.current.mentionText.length){var n=!1;return e.keys().forEach((function(e){t.keyCode===e.key&&(n=!0)})),!n}return!1}},{key:"getKeyCode",value:function(t,e,n){var i=t.tribute,o=i.range.getTriggerInfo(!1,i.hasTrailingSpace,!0,i.allowSpaces,i.autocompleteMode);return!!o&&o.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(t){this.tribute.current.element=t;var e=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);e&&(this.tribute.current.selectedPath=e.mentionSelectedPath,this.tribute.current.mentionText=e.mentionText,this.tribute.current.selectedOffset=e.mentionSelectedOffset)}},{key:"callbacks",value:function(){var t=this;return{triggerChar:function(e,n,i){var o=t.tribute;o.current.trigger=i;var s=o.collection.find((function(t){return t.trigger===i}));o.current.collection=s,o.current.mentionText.length>=o.current.collection.menuShowMinLength&&o.inputEvent&&o.showMenuFor(n,!0)},enter:function(e,n){t.tribute.isActive&&t.tribute.current.filteredItems&&(e.preventDefault(),e.stopPropagation(),setTimeout((function(){t.tribute.selectItemAtIndex(t.tribute.menuSelected,e),t.tribute.hideMenu()}),0))},escape:function(e,n){t.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),t.tribute.isActive=!1,t.tribute.hideMenu())},tab:function(e,n){t.callbacks().enter(e,n)},space:function(e,n){t.tribute.isActive&&(t.tribute.spaceSelectsMatch?t.callbacks().enter(e,n):t.tribute.allowSpaces||(e.stopPropagation(),setTimeout((function(){t.tribute.hideMenu(),t.tribute.isActive=!1}),0)))},up:function(e,n){if(t.tribute.isActive&&t.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();var i=t.tribute.current.filteredItems.length,o=t.tribute.menuSelected;i>o&&o>0?(t.tribute.menuSelected--,t.setActiveLi()):0===o&&(t.tribute.menuSelected=i-1,t.setActiveLi(),t.tribute.menu.scrollTop=t.tribute.menu.scrollHeight)}},down:function(e,n){if(t.tribute.isActive&&t.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();var i=t.tribute.current.filteredItems.length-1,o=t.tribute.menuSelected;i>o?(t.tribute.menuSelected++,t.setActiveLi()):i===o&&(t.tribute.menuSelected=0,t.setActiveLi(),t.tribute.menu.scrollTop=0)}},delete:function(e,n){t.tribute.isActive&&t.tribute.current.mentionText.length<1?t.tribute.hideMenu():t.tribute.isActive&&t.tribute.showMenuFor(n)}}}},{key:"setActiveLi",value:function(t){var e=this.tribute.menu.querySelectorAll("li"),n=e.length>>>0;t&&(this.tribute.menuSelected=parseInt(t));for(var i=0;i<n;i++){var o=e[i];if(i===this.tribute.menuSelected){o.classList.add(this.tribute.current.collection.selectClass);var s=o.getBoundingClientRect(),r=this.tribute.menu.getBoundingClientRect();if(s.bottom>r.bottom){var a=s.bottom-r.bottom;this.tribute.menu.scrollTop+=a}else if(s.top<r.top){var l=r.top-s.top;this.tribute.menu.scrollTop-=l}}else o.classList.remove(this.tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function(t,e){var n=t.getBoundingClientRect().height;if(e){var i=t.currentStyle||window.getComputedStyle(t);return n+parseFloat(i.marginTop)+parseFloat(i.marginBottom)}return n}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),e}(),r=function(){function e(n){t(this,e),this.tribute=n,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return n(e,[{key:"bind",value:function(t){var e=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce((function(){e.tribute.isActive&&e.tribute.showMenuFor(e.tribute.current.element,!1)}),300,!1),this.windowResizeEvent=this.debounce((function(){e.tribute.isActive&&e.tribute.range.positionMenuAtCaret(!0)}),300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function(t){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function(t,e,n){var i,o=arguments,s=this;return function(){var r=s,a=o,l=n&&!i;clearTimeout(i),i=setTimeout((function(){i=null,n||t.apply(r,a)}),e),l&&t.apply(r,a)}}}]),e}(),a=function(){function e(n){t(this,e),this.tribute=n,this.tribute.range=this}return n(e,[{key:"getDocument",value:function(){var t;return this.tribute.current.collection&&(t=this.tribute.current.collection.iframe),t?t.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(t){var e,n=this,i=this.tribute.current,o=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(void 0!==o){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");e=this.isContentEditable(i.element)?this.getContentEditableCaretPosition(o.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,o.mentionPosition),this.tribute.menu.style.cssText="top: ".concat(e.top,"px;\n                                     left: ").concat(e.left,"px;\n                                     right: ").concat(e.right,"px;\n                                     bottom: ").concat(e.bottom,"px;\n                                     position: absolute;\n                                     display: block;"),"auto"===e.left&&(this.tribute.menu.style.left="auto"),"auto"===e.top&&(this.tribute.menu.style.top="auto"),t&&this.scrollIntoView(),window.setTimeout((function(){var i={width:n.tribute.menu.offsetWidth,height:n.tribute.menu.offsetHeight},o=n.isMenuOffScreen(e,i),s=window.innerWidth>i.width&&(o.left||o.right),r=window.innerHeight>i.height&&(o.top||o.bottom);(s||r)&&(n.tribute.menu.style.cssText="display: none",n.positionMenuAtCaret(t))}),0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(t,e,n){var i,o=t;if(e)for(var s=0;s<e.length;s++){if(void 0===(o=o.childNodes[e[s]]))return;for(;o.length<n;)n-=o.length,o=o.nextSibling;0!==o.childNodes.length||o.length||(o=o.previousSibling)}var r=this.getWindowSelection();(i=this.getDocument().createRange()).setStart(o,n),i.setEnd(o,n),i.collapse(!0);try{r.removeAllRanges()}catch(t){}r.addRange(i),t.focus()}},{key:"replaceTriggerText",value:function(t,e,n,i,o){var s=this.getTriggerInfo(!0,n,e,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(void 0!==s){var r=this.tribute.current,a=new CustomEvent("tribute-replaced",{detail:{item:o,instance:r,context:s,event:i}});if(this.isContentEditable(r.element)){t+="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";var l=s.mentionPosition+s.mentionText.length;this.tribute.autocompleteMode||(l+=s.mentionTriggerChar.length),this.pasteHtml(t,s.mentionPosition,l)}else{var c=this.tribute.current.element,u="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";t+=u;var d=s.mentionPosition,p=s.mentionPosition+s.mentionText.length+u.length;this.tribute.autocompleteMode||(p+=s.mentionTriggerChar.length-1),c.value=c.value.substring(0,d)+t+c.value.substring(p,c.value.length),c.selectionStart=d+t.length,c.selectionEnd=d+t.length}r.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),r.element.dispatchEvent(a)}}},{key:"pasteHtml",value:function(t,e,n){var i,o;o=this.getWindowSelection(),(i=this.getDocument().createRange()).setStart(o.anchorNode,e),i.setEnd(o.anchorNode,n),i.deleteContents();var s=this.getDocument().createElement("div");s.innerHTML=t;for(var r,a,l=this.getDocument().createDocumentFragment();r=s.firstChild;)a=l.appendChild(r);i.insertNode(l),a&&((i=i.cloneRange()).setStartAfter(a),i.collapse(!0),o.removeAllRanges(),o.addRange(i))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(t){if(null===t.parentNode)return 0;for(var e=0;e<t.parentNode.childNodes.length;e++)if(t.parentNode.childNodes[e]===t)return e}},{key:"getContentEditableSelectedPath",value:function(t){var e=this.getWindowSelection(),n=e.anchorNode,i=[];if(null!=n){for(var o,s=n.contentEditable;null!==n&&"true"!==s;)o=this.getNodePositionInParent(n),i.push(o),null!==(n=n.parentNode)&&(s=n.contentEditable);return i.reverse(),{selected:n,path:i,offset:e.getRangeAt(0).startOffset}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var t=this.tribute.current,e="";if(this.isContentEditable(t.element)){var n=this.getWindowSelection().anchorNode;if(null!=n){var i=n.textContent,o=this.getWindowSelection().getRangeAt(0).startOffset;i&&o>=0&&(e=i.substring(0,o))}}else{var s=this.tribute.current.element;if(s){var r=s.selectionStart;s.value&&r>=0&&(e=s.value.substring(0,r))}}return e}},{key:"getLastWordInText",value:function(t){var e=(t=t.replace(/\u00A0/g," ")).split(/\s+/);return e[e.length-1].trim()}},{key:"getTriggerInfo",value:function(t,e,n,i,o){var s,r,a,l=this,c=this.tribute.current;if(this.isContentEditable(c.element)){var u=this.getContentEditableSelectedPath(c);u&&(s=u.selected,r=u.path,a=u.offset)}else s=this.tribute.current.element;var d=this.getTextPrecedingCurrentSelection(),p=this.getLastWordInText(d);if(o)return{mentionPosition:d.length-p.length,mentionText:p,mentionSelectedElement:s,mentionSelectedPath:r,mentionSelectedOffset:a};if(null!=d){var h,f=-1;if(this.tribute.collection.forEach((function(t){var e=t.trigger,i=t.requireLeadingSpace?l.lastIndexWithLeadingSpace(d,e):d.lastIndexOf(e);i>f&&(f=i,h=e,n=t.requireLeadingSpace)})),f>=0&&(0===f||!n||/[\xA0\s]/g.test(d.substring(f-1,f)))){var m=d.substring(f+h.length,d.length);h=d.substring(f,f+h.length);var v=m.substring(0,1),g=m.length>0&&(" "===v||" "===v);e&&(m=m.trim());var b=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=b.test(m),!g&&(t||!b.test(m)))return{mentionPosition:f,mentionText:m,mentionSelectedElement:s,mentionSelectedPath:r,mentionSelectedOffset:a,mentionTriggerChar:h}}}}},{key:"lastIndexWithLeadingSpace",value:function(t,e){for(var n=t.split("").reverse().join(""),i=-1,o=0,s=t.length;o<s;o++){for(var r=o===t.length-1,a=/\s/.test(n[o+1]),l=!0,c=e.length-1;c>=0;c--)if(e[c]!==n[o-c]){l=!1;break}if(l&&(r||a)){i=t.length-1-o;break}}return i}},{key:"isContentEditable",value:function(t){return"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName}},{key:"isMenuOffScreen",value:function(t,e){var n=window.innerWidth,i=window.innerHeight,o=document.documentElement,s=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),r=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),a="number"==typeof t.top?t.top:r+i-t.bottom-e.height,l="number"==typeof t.right?t.right:t.left+e.width,c="number"==typeof t.bottom?t.bottom:t.top+e.height,u="number"==typeof t.left?t.left:s+n-t.right-e.width;return{top:a<Math.floor(r),right:l>Math.ceil(s+n),bottom:c>Math.ceil(r+i),left:u<Math.floor(s)}}},{key:"getMenuDimensions",value:function(){var t={width:null,height:null};return this.tribute.menu.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 display: block;\n                                 visibility; hidden;",t.width=this.tribute.menu.offsetWidth,t.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",t}},{key:"getTextAreaOrInputUnderlinePosition",value:function(t,e,n){var i=null!==window.mozInnerScreenX,o=this.getDocument().createElement("div");o.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(o);var s=o.style,r=window.getComputedStyle?getComputedStyle(t):t.currentStyle;s.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(s.wordWrap="break-word"),s.position="absolute",s.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(t){s[t]=r[t]})),i?(s.width="".concat(parseInt(r.width)-2,"px"),t.scrollHeight>parseInt(r.height)&&(s.overflowY="scroll")):s.overflow="hidden",o.textContent=t.value.substring(0,e),"INPUT"===t.nodeName&&(o.textContent=o.textContent.replace(/\s/g," "));var a=this.getDocument().createElement("span");a.textContent=t.value.substring(e)||".",o.appendChild(a);var l=t.getBoundingClientRect(),c=document.documentElement,u=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),d=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),p=0,h=0;this.menuContainerIsBody&&(p=l.top,h=l.left);var f={top:p+d+a.offsetTop+parseInt(r.borderTopWidth)+parseInt(r.fontSize)-t.scrollTop,left:h+u+a.offsetLeft+parseInt(r.borderLeftWidth)},m=window.innerWidth,v=window.innerHeight,g=this.getMenuDimensions(),b=this.isMenuOffScreen(f,g);b.right&&(f.right=m-f.left,f.left="auto");var y=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(b.bottom){var w=y-(v-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);f.bottom=w+(v-l.top-a.offsetTop),f.top="auto"}return(b=this.isMenuOffScreen(f,g)).left&&(f.left=m>g.width?u+m-g.width:u,delete f.right),b.top&&(f.top=v>g.height?d+v-g.height:d,delete f.bottom),this.getDocument().body.removeChild(o),f}},{key:"getContentEditableCaretPosition",value:function(t){var e,n=this.getWindowSelection();(e=this.getDocument().createRange()).setStart(n.anchorNode,t),e.setEnd(n.anchorNode,t),e.collapse(!1);var i=e.getBoundingClientRect(),o=document.documentElement,s=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),r=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),a={left:i.left+s,top:i.top+i.height+r},l=window.innerWidth,c=window.innerHeight,u=this.getMenuDimensions(),d=this.isMenuOffScreen(a,u);d.right&&(a.left="auto",a.right=l-i.left-s);var p=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(d.bottom){var h=p-(c-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);a.top="auto",a.bottom=h+(c-i.top)}return(d=this.isMenuOffScreen(a,u)).left&&(a.left=l>u.width?s+l-u.width:s,delete a.right),d.top&&(a.top=c>u.height?r+c-u.height:r,delete a.bottom),this.menuContainerIsBody||(a.left=a.left?a.left-this.tribute.menuContainer.offsetLeft:a.left,a.top=a.top?a.top-this.tribute.menuContainer.offsetTop:a.top),a}},{key:"scrollIntoView",value:function(t){var e,n=this.menu;if(void 0!==n){for(;void 0===e||0===e.height;)if(0===(e=n.getBoundingClientRect()).height&&(void 0===(n=n.childNodes[0])||!n.getBoundingClientRect))return;var i=e.top,o=i+e.height;if(i<0)window.scrollTo(0,window.pageYOffset+e.top-20);else if(o>window.innerHeight){var s=window.pageYOffset+e.top-20;s-window.pageYOffset>100&&(s=window.pageYOffset+100);var r=window.pageYOffset-(window.innerHeight-o);r>s&&(r=s),window.scrollTo(0,r)}}}},{key:"menuContainerIsBody",get:function(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}}]),e}(),l=function(){function e(n){t(this,e),this.tribute=n,this.tribute.search=this}return n(e,[{key:"simpleFilter",value:function(t,e){var n=this;return e.filter((function(e){return n.test(t,e)}))}},{key:"test",value:function(t,e){return null!==this.match(t,e)}},{key:"match",value:function(t,e,n){n=n||{},e.length;var i=n.pre||"",o=n.post||"",s=n.caseSensitive&&e||e.toLowerCase();if(n.skip)return{rendered:e,score:0};t=n.caseSensitive&&t||t.toLowerCase();var r=this.traverse(s,t,0,0,[]);return r?{rendered:this.render(e,r.cache,i,o),score:r.score}:null}},{key:"traverse",value:function(t,e,n,i,o){if(e.length===i)return{score:this.calculateScore(o),cache:o.slice()};if(!(t.length===n||e.length-i>t.length-n)){for(var s,r,a=e[i],l=t.indexOf(a,n);l>-1;){if(o.push(l),r=this.traverse(t,e,l+1,i+1,o),o.pop(),!r)return s;(!s||s.score<r.score)&&(s=r),l=t.indexOf(a,l+1)}return s}}},{key:"calculateScore",value:function(t){var e=0,n=1;return t.forEach((function(i,o){o>0&&(t[o-1]+1===i?n+=n+1:n=1),e+=n})),e}},{key:"render",value:function(t,e,n,i){var o=t.substring(0,e[0]);return e.forEach((function(s,r){o+=n+t[s]+i+t.substring(s+1,e[r+1]?e[r+1]:t.length)})),o}},{key:"filter",value:function(t,e,n){var i=this;return n=n||{},e.reduce((function(e,o,s,r){var a=o;n.extract&&((a=n.extract(o))||(a=""));var l=i.match(t,a,n);return null!=l&&(e[e.length]={string:l.rendered,score:l.score,index:s,original:o}),e}),[]).sort((function(t,e){var n=e.score-t.score;return n||t.index-e.index}))}}]),e}();return function(){function e(n){var i,o=this,c=n.values,u=void 0===c?null:c,d=n.iframe,p=void 0===d?null:d,h=n.selectClass,f=void 0===h?"highlight":h,m=n.containerClass,v=void 0===m?"tribute-container":m,g=n.itemClass,b=void 0===g?"":g,y=n.trigger,w=void 0===y?"@":y,_=n.autocompleteMode,C=void 0!==_&&_,x=n.selectTemplate,k=void 0===x?null:x,T=n.menuItemTemplate,S=void 0===T?null:T,L=n.lookup,M=void 0===L?"key":L,E=n.fillAttr,I=void 0===E?"value":E,O=n.collection,A=void 0===O?null:O,R=n.menuContainer,j=void 0===R?null:R,F=n.noMatchTemplate,B=void 0===F?null:F,D=n.requireLeadingSpace,P=void 0===D||D,z=n.allowSpaces,N=void 0!==z&&z,$=n.replaceTextSuffix,H=void 0===$?null:$,U=n.positionMenu,W=void 0===U||U,q=n.spaceSelectsMatch,V=void 0!==q&&q,Y=n.searchOpts,K=void 0===Y?{}:Y,J=n.menuItemLimit,Q=void 0===J?null:J,X=n.menuShowMinLength,Z=void 0===X?0:X;if(t(this,e),this.autocompleteMode=C,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=j,this.allowSpaces=N,this.replaceTextSuffix=H,this.positionMenu=W,this.hasTrailingSpace=!1,this.spaceSelectsMatch=V,this.autocompleteMode&&(w="",N=!1),u)this.collection=[{trigger:w,iframe:p,selectClass:f,containerClass:v,itemClass:b,selectTemplate:(k||e.defaultSelectTemplate).bind(this),menuItemTemplate:(S||e.defaultMenuItemTemplate).bind(this),noMatchTemplate:(i=B,"string"==typeof i?""===i.trim()?null:i:"function"==typeof i?i.bind(o):B||function(){return"<li>No Match Found!</li>"}.bind(o)),lookup:M,fillAttr:I,values:u,requireLeadingSpace:P,searchOpts:K,menuItemLimit:Q,menuShowMinLength:Z}];else{if(!A)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=A.map((function(t){return{trigger:t.trigger||w,iframe:t.iframe||p,selectClass:t.selectClass||f,containerClass:t.containerClass||v,itemClass:t.itemClass||b,selectTemplate:(t.selectTemplate||e.defaultSelectTemplate).bind(o),menuItemTemplate:(t.menuItemTemplate||e.defaultMenuItemTemplate).bind(o),noMatchTemplate:function(t){return"string"==typeof t?""===t.trim()?null:t:"function"==typeof t?t.bind(o):B||function(){return"<li>No Match Found!</li>"}.bind(o)}(B),lookup:t.lookup||M,fillAttr:t.fillAttr||I,values:t.values,requireLeadingSpace:t.requireLeadingSpace,searchOpts:t.searchOpts||K,menuItemLimit:t.menuItemLimit||Q,menuShowMinLength:t.menuShowMinLength||Z}}))}new a(this),new s(this),new r(this),new l(this)}return n(e,[{key:"triggers",value:function(){return this.collection.map((function(t){return t.trigger}))}},{key:"attach",value:function(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array)for(var e=t.length,n=0;n<e;++n)this._attach(t[n]);else this._attach(t)}},{key:"_attach",value:function(t){t.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+t.nodeName),this.ensureEditable(t),this.events.bind(t),t.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(t){if(-1===e.inputTypes().indexOf(t.nodeName)){if(!t.contentEditable)throw new Error("[Tribute] Cannot bind to "+t.nodeName);t.contentEditable=!0}}},{key:"createMenu",value:function(t){var e=this.range.getDocument().createElement("div"),n=this.range.getDocument().createElement("ul");return e.className=t,e.appendChild(n),this.menuContainer?this.menuContainer.appendChild(e):this.range.getDocument().body.appendChild(e)}},{key:"showMenuFor",value:function(t,e){var n=this;if(!this.isActive||this.current.element!==t||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),t.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var o=function(t){if(n.isActive){var o=n.search.filter(n.current.mentionText,t,{pre:n.current.collection.searchOpts.pre||"<span>",post:n.current.collection.searchOpts.post||"</span>",skip:n.current.collection.searchOpts.skip,extract:function(t){if("string"==typeof n.current.collection.lookup)return t[n.current.collection.lookup];if("function"==typeof n.current.collection.lookup)return n.current.collection.lookup(t,n.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});n.current.collection.menuItemLimit&&(o=o.slice(0,n.current.collection.menuItemLimit)),n.current.filteredItems=o;var s=n.menu.querySelector("ul");if(n.range.positionMenuAtCaret(e),!o.length){var r=new CustomEvent("tribute-no-match",{detail:n.menu});return n.current.element.dispatchEvent(r),void("function"==typeof n.current.collection.noMatchTemplate&&!n.current.collection.noMatchTemplate()||!n.current.collection.noMatchTemplate?n.hideMenu():"function"==typeof n.current.collection.noMatchTemplate?s.innerHTML=n.current.collection.noMatchTemplate():s.innerHTML=n.current.collection.noMatchTemplate)}s.innerHTML="";var a=n.range.getDocument().createDocumentFragment();o.forEach((function(t,e){var o=n.range.getDocument().createElement("li");o.setAttribute("data-index",e),o.className=n.current.collection.itemClass,o.addEventListener("mousemove",(function(t){var e=i(n._findLiTarget(t.target),2),o=(e[0],e[1]);0!==t.movementY&&n.events.setActiveLi(o)})),n.menuSelected===e&&o.classList.add(n.current.collection.selectClass),o.innerHTML=n.current.collection.menuItemTemplate(t),a.appendChild(o)})),s.appendChild(a)}};"function"==typeof this.current.collection.values?this.current.collection.values(this.current.mentionText,o):o(this.current.collection.values)}}},{key:"_findLiTarget",value:function(t){if(!t)return[];var e=t.getAttribute("data-index");return e?[t,e]:this._findLiTarget(t.parentNode)}},{key:"showMenuForCollection",value:function(t,e){t!==document.activeElement&&this.placeCaretAtEnd(t),this.current.collection=this.collection[e||0],this.current.externalTrigger=!0,this.current.element=t,t.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(t,this.current.collection.trigger),this.showMenuFor(t)}},{key:"placeCaretAtEnd",value:function(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(e)}else if(void 0!==document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(t),i.collapse(!1),i.select()}}},{key:"insertTextAtCursor",value:function(t){var e,n;(n=(e=window.getSelection()).getRangeAt(0)).deleteContents();var i=document.createTextNode(t);n.insertNode(i),n.selectNodeContents(i),n.collapse(!1),e.removeAllRanges(),e.addRange(n)}},{key:"insertAtCaret",value:function(t,e){var n=t.scrollTop,i=t.selectionStart,o=t.value.substring(0,i),s=t.value.substring(t.selectionEnd,t.value.length);t.value=o+e+s,i+=e.length,t.selectionStart=i,t.selectionEnd=i,t.focus(),t.scrollTop=n}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(t,e){if("number"==typeof(t=parseInt(t))&&!isNaN(t)){var n=this.current.filteredItems[t],i=this.current.collection.selectTemplate(n);null!==i&&this.replaceText(i,e,n)}}},{key:"replaceText",value:function(t,e,n){this.range.replaceTriggerText(t,!0,!0,e,n)}},{key:"_append",value:function(t,e,n){if("function"==typeof t.values)throw new Error("Unable to append to values, as it is a function.");t.values=n?e:t.values.concat(e)}},{key:"append",value:function(t,e,n){var i=parseInt(t);if("number"!=typeof i)throw new Error("please provide an index for the collection to update.");var o=this.collection[i];this._append(o,e,n)}},{key:"appendCurrent",value:function(t,e){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,t,e)}},{key:"detach",value:function(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array)for(var e=t.length,n=0;n<e;++n)this._detach(t[n]);else this._detach(t)}},{key:"_detach",value:function(t){var e=this;this.events.unbind(t),t.tributeMenu&&this.menuEvents.unbind(t.tributeMenu),setTimeout((function(){t.removeAttribute("data-tribute"),e.isActive=!1,t.tributeMenu&&t.tributeMenu.remove()}))}},{key:"isActive",get:function(){return this._isActive},set:function(t){if(this._isActive!=t&&(this._isActive=t,this.current.element)){var e=new CustomEvent("tribute-active-".concat(t));this.current.element.dispatchEvent(e)}}}],[{key:"defaultSelectTemplate",value:function(t){return void 0===t?"".concat(this.current.collection.trigger).concat(this.current.mentionText):this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+t.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+t.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(t){return t.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),e}()}))},e59c:function(t,e,n){t.exports=n.p+"img/collapse_2.b4244534.svg"},e934:function(t,e,n){"use strict";n("69a6")},ed8b:function(t,e,n){"use strict";n("ff10")},f315:function(t,e,n){t.exports=n.p+"img/collapse_1.74036d18.svg"},f78f:function(t,e,n){},fd35:function(t,e,n){},ff10:function(t,e,n){},ffd6:function(t,e,n){var i=n("3729"),o=n("1310"),s="[object Symbol]";function r(t){return"symbol"==typeof t||o(t)&&i(t)==s}t.exports=r}}]);