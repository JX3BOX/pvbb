(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06df86ea"],{"01ea":function(t,e,n){"use strict";n.d(e,"g",(function(){return s})),n.d(e,"f",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"i",(function(){return u})),n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return l})),n.d(e,"c",(function(){return g})),n.d(e,"d",(function(){return d})),n.d(e,"h",(function(){return m})),n.d(e,"j",(function(){return h}));var i=n("5530"),o=n("65c2"),a=Object(i["a"])(Object(i["a"])({},o),{},{__dataPath:"https://data.jx3box.com/",__imgPath:"https://img.jx3box.com/",__iconPath:"https://icon.jx3box.com/"}),s=a.__imgPath,r=a.__dataPath,c=(a.__iconPath,a.__cms),u=(a.__down,a.__node,a.__ossMirror,a.__ossRoot,a.__visibleMap),f=(a.default_avatar,a.__Root),l=a.__OriginRoot,g=(a.__Github,a.__Preview,a.__server,a.__sso,a.__spider,a.__spider2,a.__next,a.__pay,a.__team,a.__lua,a.__dbm,a.__helperUrl,a.__os,a.__jx3,a.__cdn),d=(a.__staticPath,a.__clients),m=a.__postType,h=(a.__wikiType,a.__appType,a.__gameType,a.__sourceType,a.__userGroup,a.__userLevel,a.__userLevelColor,a.__Links,a.feedback)},"0608":function(t){t.exports=JSON.parse('{"#下雨":"下雨.gif","#严寒":"严寒.gif","#亲亲":"亲亲.gif","#傲慢":"傲慢.gif","#冷汗":"冷汗.gif","#凶恶":"凶恶.gif","#刀":"刀.gif","#发怒":"发怒.gif","#口水":"口水.gif","#可怜":"可怜.gif","#吐":"吐.gif","#吓":"吓.gif","#呆":"呆.gif","#呲牙":"呲牙.gif","#咖啡":"咖啡.gif","#唇":"唇.gif","#喜欢":"喜欢.gif","#嘴":"嘴.gif","#噢":"噢.gif","#困":"困.gif","#大笑":"大笑.gif","#太阳":"太阳.gif","#媚眼":"媚眼.gif","#害羞":"害羞.gif","#寒":"寒.gif","#尴尬":"尴尬.gif","#差劲":"差劲.gif","#巴掌":"巴掌.gif","#强":"强.gif","#得意":"得意.gif","#微笑":"微笑.gif","#心碎":"心碎.gif","#恐慌":"恐慌.gif","#恶心":"恶心.gif","#感叹号":"感叹号.gif","#扁嘴":"扁嘴.gif","#打雷":"打雷.gif","#拍手":"拍手.gif","#握手":"握手.gif","#撇嘴":"撇嘴.gif","#无奈":"无奈.gif","#昏":"昏.gif","#晕":"晕.gif","#月亮":"月亮.gif","#标记":"标记.gif","#樱桃":"樱桃.gif","#欣喜":"欣喜.gif","#沉默":"沉默.gif","#流汗":"流汗.gif","#流泪":"流泪.gif","#灯泡":"灯泡.gif","#烟花":"烟花.gif","#爱心":"爱心.gif","#狂汗":"狂汗.gif","#狡猾":"狡猾.gif","#狡诈":"狡诈.gif","#猪":"猪.gif","#玫瑰":"玫瑰.gif","#生气":"生气.gif","#电话":"电话.gif","#睡":"睡.gif","#礼物":"礼物.gif","#笨猪":"笨猪.gif","#第一名":"第一名.gif","#第三名":"第三名.gif","#第二名":"第二名.gif","#红灯":"红灯.gif","#绿灯":"绿灯.gif","#胜利":"胜利.gif","#舌头":"舌头.gif","#色":"色.gif","#花":"花.gif","#苹果":"苹果.gif","#菠萝":"菠萝.gif","#蒜头":"蒜头.gif","#蜡烛":"蜡烛.gif","#衰":"衰.gif","#西瓜":"西瓜.gif","#讨厌":"讨厌.gif","#讶异":"讶异.gif","#鄙视":"鄙视.gif","#酷":"酷.gif","#钱":"钱.gif","#锤子":"锤子.gif","#问号":"问号.gif","#阴险":"阴险.gif","#难过":"难过.gif","#雪糕":"雪糕.gif","#饮料":"饮料.gif","#馒头":"馒头.gif","#香蕉":"香蕉.gif","#骷髅":"骷髅.gif","#鬼脸":"鬼脸.gif","#黄灯":"黄灯.gif"}')},"3e55":function(t,e,n){t.exports=n.p+"img/copy-icon.be78949c.svg"},"498a":function(t,e,n){"use strict";var i=n("23e7"),o=n("58a8").trim,a=n("c8d2");i({target:"String",proto:!0,forced:a("trim")},{trim:function(){return o(this)}})},"506c":function(t,e,n){"use strict";var i=n("65c2"),o=n("2ef0");const{__imgPath:a,__dataPath:s}=i,r=[],c=[];let u=!1;async function f(){if(c.length>0)return;if(u&&0===c.length)return await new Promise(t=>{r.push(t)});u=!0;const t=sessionStorage.getItem("jx3_emotion");if(t){const e=JSON.parse(t);c.push(...e.map(t=>t.items).reduce((t,e)=>t.concat(e),[])),c.push(...JSON.parse(t))}else{const t=await fetch(s+"emotion/output/catalog.json").then(t=>t.json());c.push(...t.map(t=>t.items).reduce((t,e)=>t.concat(e),[])),sessionStorage.setItem("jx3_emotion",JSON.stringify(t))}u=!1,r.forEach(t=>t())}class l{constructor(t){this.joke=String(t).trim()}async _renderHTML(t){if(!this.joke.includes("#"))return this.joke;await f();const e=Object(o["keyBy"])(c,"key");for(const n in e)if(this.joke.includes(n)){let i=e[n].filename;i.startsWith("http")||(i=`${a}emotion/output/${e[n].filename}`);let o="";const{maxWidth:s=60,maxHeight:r=60}=t||{};o+=`max-width: ${s}px;`,o+=`max-height: ${r}px;`,this.joke=this.joke.replaceAll(n,`<img src="${i}" alt="${n}" title="${n}" style="${o}" />`)}return this.joke}}e["a"]=l},"8bca":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"v-joke"},[e("div",{ref:"chatContainer",staticClass:"m-chat-container",on:{scroll:t.handleScroll}},[e("div",{ref:"chatList",staticClass:"m-chat-list"},[t._l(t.jokes,(function(n,i){var o,a;return[n.isDateMarker?[e("div",{key:n.id||i,staticClass:"u-chat-date"},[t._v(t._s(n.date))])]:[e("div",{key:n.id||i,staticClass:"m-chat-item"},[e("div",{staticClass:"m-message"},[e("div",{staticClass:"m-avatar"},[e("img",{staticClass:"u-avatar",attrs:{src:t._f("showAvatar")(null===(o=n.user_info)||void 0===o?void 0:o.user_avatar)}})]),e("div",{staticClass:"m-content"},[e("div",{staticClass:"m-header"},[e("span",{staticClass:"u-author"},[t._v(t._s((null===(a=n.user_info)||void 0===a?void 0:a.display_name)||"匿名"))])]),e("div",{staticClass:"m-body",on:{touchstart:function(e){return t.jokeTouchStart(n)},touchend:t.jokeTouchEnd}},[e("div",{staticClass:"u-text",domProps:{innerHTML:t._s(n.parsedContent)}})])])])])]]})),e("div",{staticClass:"u-ent-time"},[t._v(" "+t._s("".concat(t.userEntTime," 你已加入聊天室"))+" ")])],2)]),e("div",{staticClass:"m-send"},[e("div",{staticClass:"m-input-container"},[e("el-input",{staticClass:"u-input",attrs:{autosize:{minRows:1,maxRows:2},type:"textarea",placeholder:"",resize:"none"},model:{value:t.sendInputVal,callback:function(e){t.sendInputVal=e},expression:"sendInputVal"}}),t.isDarkModeStatus?e("img",{staticClass:"c-comment-emotion",attrs:{src:n("f779"),alt:""},on:{click:function(e){t.showEmotionContainer=!t.showEmotionContainer}}}):e("img",{staticClass:"c-comment-emotion",attrs:{src:n("a56e")},on:{click:function(e){t.showEmotionContainer=!t.showEmotionContainer}}}),e("div",{staticClass:"u-btn",class:{disabled:!t.sendInputVal.length},on:{click:t.publish}},[t._v("发布")])],1),e("div",{staticClass:"m-emotion-container",class:{show:t.showEmotionContainer}},[e("jokeEmotion",{attrs:{max:6},on:{selected:t.handleEmotionSelected}})],1)]),e("el-drawer",{attrs:{visible:t.copyVisible,direction:"btt","custom-class":"m-joke-copy-drawer"},on:{"update:visible":function(e){t.copyVisible=e}}},[e("div",{staticClass:"m-copy-tip"},[e("img",{staticClass:"u-icon",attrs:{src:n("3e55"),alt:""}}),e("div",{staticClass:"u-text"},[t._v("复制骚话")])]),e("div",{staticClass:"u-content",domProps:{innerHTML:t._s(t.copySelectJoke.parsedContent)}}),e("div",{staticClass:"u-btn",on:{click:t.handleCopy}},[t._v("复制")])])],1)},o=[],a=n("3835"),s=n("2909"),r=n("5530"),c=n("c14f"),u=n("1da1"),f=(n("99af"),n("4de4"),n("caad"),n("d81d"),n("14d9"),n("e9f5"),n("910d"),n("7d54"),n("ab43"),n("a732"),n("b64b"),n("d3b7"),n("ac1f"),n("00b4"),n("25f0"),n("2532"),n("3ca3"),n("466d"),n("5319"),n("498a"),n("159b"),n("ddb0"),n("0608")),l=n("506c"),g=n("c8a9"),d=n("85e4"),m=n("c9d2"),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-emotion"},[e("el-tabs",{staticClass:"u-tabs",attrs:{type:"card","tab-position":"bottom",size:"small"}},t._l(t.decorationEmotion,(function(n){return e("el-tab-pane",{key:n.group_id,attrs:{label:n.group_name},scopedSlots:t._u([{key:"label",fn:function(){return[e("img",{staticClass:"u-tab-label",attrs:{src:t.emotionLink(n.items[0].filename),alt:n.items[0].key,title:n.group_name}})]},proxy:!0}],null,!0)},[e("div",{staticClass:"c-jx3box-emotion-list"},t._l(n.items,(function(n){return e("span",{key:n.emotion_id,staticClass:"c-jx3box-emotion-item",on:{click:function(e){return t.handleEmotionClick(n)}}},[e("img",{staticClass:"u-emotion-item",attrs:{src:t.emotionLink(n.filename),alt:n.key,title:n.key}})])})),0)])})),1)],1)},p=[],_=(n("fb6a"),n("e9c4"),n("2ca0"),n("c402")),v=n("01ea"),b={data:function(){return{emotionList:[],decoration:[],EmojiPath:v["g"]+"emotion/output/"}},computed:{isLogin:function(){return m["a"].isLogin()},decorationEmotion:function(t){var e=t.emotionList,n=t.decoration,i=e.filter((function(t){return 0===t.group_id}));if(0===n.length)return console.log(i),i;var o=e.filter((function(t){return n.includes(t.group_name)}));return[].concat(Object(s["a"])(i),Object(s["a"])(o)).slice(0,this.max)}},mounted:function(){this.loadEmotionList(),this.loadDecoration()},methods:{emotionLink:function(t){return t?t.startsWith("http")?t:"".concat(this.EmojiPath).concat(t):""},loadEmotionList:function(){var t=this;try{var e=sessionStorage.getItem("jx3_emotion");if(e)return void(this.emotionList=JSON.parse(e));fetch("".concat(v["f"],"emotion/output/catalog.json")).then((function(t){return t.json()})).then((function(e){t.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}catch(n){fetch("".concat(v["f"],"emotion/output/catalog.json")).then((function(t){return t.json()})).then((function(e){t.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}},loadDecoration:function(){var t=this;m["a"].isLogin()&&Object(_["b"])({using:1,type:"emotion"}).then((function(e){var n,i;t.decoration=null===(n=e.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.map((function(t){return null===t||void 0===t?void 0:t.val}))}))},handleEmotionClick:function(t){this.$emit("selected",t)}}},j=b,k=(n("d663"),n("2877")),y=Object(k["a"])(j,h,p,!1,null,"2fd3bb6e",null),O=y.exports,w={name:"Joke",components:{jokeEmotion:O},data:function(){return{loading:!1,jokes:[],currentPage:1,pageSize:20,scrollToBottomFlag:!0,userEntTime:"",copyVisible:!1,copySelectJoke:{},longPressTimeOut:"",sendInputVal:"",isDarkModeStatus:window.matchMedia("(prefers-color-scheme: dark)").matches,showEmotionContainer:!1}},computed:{isLogin:function(){return m["a"].isLogin()}},filters:{dateFormat:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return dateFormat(new Date(t))})),showAvatar:function(t){return Object(d["u"])(t)}},mounted:function(){this.fetchJokes();var t=new Date,e=t.getHours(),n=t.getMinutes();this.userEntTime="".concat(e,":").concat(n<10?"0"+n:n)},methods:{parse:function(t){return Object(u["a"])(Object(c["a"])().m((function e(){var n,i;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return n=new l["a"](t),e.n=1,n._renderHTML();case 1:return i=e.v,e.a(2,i)}}),e)})))()},fetchJokes:function(){var t=this;return Object(u["a"])(Object(c["a"])().m((function e(){var n;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:if(!t.loading){e.n=1;break}return e.a(2);case 1:t.loading=!0,n={page:t.currentPage,per:t.pageSize},Object(g["b"])(n).then(function(){var e=Object(u["a"])(Object(c["a"])().m((function e(n){var i,o,a,f,l;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return a=(null===n||void 0===n||null===(i=n.data)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.list)||[],a.reverse(),e.n=1,Promise.all(a.map(function(){var e=Object(u["a"])(Object(c["a"])().m((function e(n){var i;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return e.n=1,t.parse(n.content);case 1:return i=e.v,e.a(2,Object(r["a"])(Object(r["a"])({},n),{},{parsedContent:i}))}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:f=e.v,l=[].concat(Object(s["a"])(f),Object(s["a"])(t.jokes)),l.forEach((function(t){console.log(t.created_at)})),t.jokes=t.insertDateMarkers(l),t.currentPage++,t.scrollToBottomFlag&&(t.scrollToBottom(),t.scrollToBottomFlag=!1);case 2:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.loading=!1}));case 2:return e.a(2)}}),e)})))()},insertDateMarkers:function(t){var e=this;if(!t.length)return[];var n=t.filter((function(t){return!t.isDateMarker})),i=[],o=null;return n.forEach((function(n){var a=n.created_at.split("T")[0];if(a!==o){var s=t.some((function(t){return t.isDateMarker&&t.date===a}));s||i.push({isDateMarker:!0,date:e.formatDateToChinese(a),created_at:a+"T00:00:00.000Z"}),o=a}i.push(n)})),i},formatDateToChinese:function(t){var e=t.split("-"),n=Object(a["a"])(e,3),i=(n[0],n[1]),o=n[2];return"".concat(parseInt(i),"月").concat(parseInt(o),"日")},handleScroll:function(){var t=this.$refs.chatContainer;t&&0===t.scrollTop&&this.fetchJokes()},scrollToBottom:function(){var t=this;this.$nextTick((function(){var e=t.$refs.chatContainer;e&&(e.scrollTop=e.scrollHeight)}))},jokeTouchStart:function(t){var e=this;this.copySelectJoke=t,this.longPressTimeOut=setTimeout((function(){e.copyVisible=!0}),500)},jokeTouchEnd:function(){clearTimeout(this.longPressTimeOut)},handleCopy:function(){var t=this;navigator.clipboard.writeText(this.copySelectJoke.content).then((function(){t.$message({message:"复制成功",type:"success"}),t.copyVisible=!1}))},handleEmotionSelected:function(t){var e=this;return Object(u["a"])(Object(c["a"])().m((function n(){return Object(c["a"])().w((function(n){while(1)switch(n.n){case 0:e.sendInputVal+=t.key;case 1:return n.a(2)}}),n)})))()},publish:function(){var t=this;if(this.isLogin){if(!this.check())return;Object(g["c"])({type:"0",content:this.sendInputVal}).then((function(e){t.$message({message:"发布成功,请等待审核",type:"success"}),t.sendInputVal=""}))}else m["a"].toLogin()},check:function(){var t,e=Object.keys(f),n=this.sendInputVal.trim(),i=/(#[\u4e00-\u9fa5]{1})/g,o=/(#[\u4e00-\u9fa5]{2})/g,a=/(#[\u4e00-\u9fa5]{3})/g;if(!n.length)return this.$notify({title:"错误",message:"内容不能为空",type:"error"}),!1;var s=n.match(i)?n.match(i).filter((function(t){return e.includes(t)})):[];s.forEach((function(t){n=n.replace(t,"")}));var r=n.match(o)?n.match(o).filter((function(t){return e.includes(t)})):[];r.forEach((function(t){n=n.replace(t,"")}));var c=n.match(a)?n.match(a).filter((function(t){return e.includes(t)})):[];c.forEach((function(t){n=n.replace(t,"")}));var u=s.length+r.length+c.length;if(this.contentLength=u,u>10)return this.$notify({title:"错误",message:"表情个数不能超过10个",type:"error"}),!1;var l=(null===(t=n.match(/[\u4e00-\u9fa5]/g))||void 0===t?void 0:t.length)||0,g=2*l+(n.length-l),d=/^\d+$/.test(n),m=/^[a-zA-Z]+$/.test(n);return(d||m)&&n.length>128?(this.$notify({title:"提示",message:"纯数字或纯字母内容长度不能超过128个字符",type:"warning"}),!1):!d&&!m&&l>64?(this.$notify({title:"提示",message:"中文字符不能超过64个",type:"warning"}),!1):!(!d&&!m&&g>128)||(this.$notify({title:"提示",message:"内容长度不能超过128个字符",type:"warning"}),!1)}}},C=w,x=(n("fa7b"),Object(k["a"])(C,i,o,!1,null,null,null));e["default"]=x.exports},9854:function(t,e,n){},a56e:function(t,e,n){t.exports=n.p+"img/emo-light.8e7e2ef7.svg"},a732:function(t,e,n){"use strict";var i=n("23e7"),o=n("c65b"),a=n("2266"),s=n("59ed"),r=n("825a"),c=n("46c4"),u=n("2a62"),f=n("f99f"),l=f("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:l},{some:function(t){r(this);try{s(t)}catch(i){u(this,"throw",i)}if(l)return o(l,this,t);var e=c(this),n=0;return a(e,(function(e,i){if(t(e,n++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},ab9d:function(t,e,n){},c402:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return s}));var i=n("41cb");n("01ea");function o(t){return Object(i["a"])().get("/api/cms/topic/bucket",{params:t})}var a=function(t){return Object(i["a"])().get("api/cms/config/banner",{params:t})};function s(t){return Object(i["a"])().get("/api/cms/user/decoration",{params:t})}var r=function(t){return Object(i["a"])().get("/api/cms/user/list",{params:t})}},c8a9:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s})),n.d(e,"e",(function(){return r})),n.d(e,"d",(function(){return u})),n.d(e,"c",(function(){return o})),n.d(e,"f",(function(){return c}));var i=n("41cb");function o(t){return Object(i["b"])().post("/api/joke/share",t)}var a=function(t){return Object(i["a"])().get("/api/cms/post/jokes",{params:t})};function s(t){return Object(i["a"])().get("/api/cms/post/joke/".concat(t))}var r=function(t){return Object(i["a"])().put("/api/cms/post/joke/".concat(t,"/star"))};function c(t){return Object(i["a"])().put("/api/cms/post/joke/".concat(t,"/unstar"))}var u=function(t){return Object(i["a"])().delete("/api/cms/post/joke/".concat(t))}},c8d2:function(t,e,n){"use strict";var i=n("5e77").PROPER,o=n("d039"),a=n("5899"),s="​᠎";t.exports=function(t){return o((function(){return!!a[t]()||s[t]()!==s||i&&a[t].name!==t}))}},d663:function(t,e,n){"use strict";n("9854")},f779:function(t,e,n){t.exports=n.p+"img/emo-dark.222c357c.svg"},fa7b:function(t,e,n){"use strict";n("ab9d")}}]);