(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-774a2de5"],{"0d88":function(t,e,n){"use strict";n("10cf")},"10cf":function(t,e,n){},"3e55":function(t,e,n){t.exports=n.p+"img/copy-icon.be78949c.svg"},"506c":function(t,e,n){"use strict";var a=n("65c2"),s=n("2ef0");const{__imgPath:i,__dataPath:o}=a,r=[],c=[];let u=!1;async function l(){if(c.length>0)return;if(u&&0===c.length)return await new Promise(t=>{r.push(t)});u=!0;const t=sessionStorage.getItem("jx3_emotion");if(t){const e=JSON.parse(t);c.push(...e.map(t=>t.items).reduce((t,e)=>t.concat(e),[])),c.push(...JSON.parse(t))}else{const t=await fetch(o+"emotion/output/catalog.json").then(t=>t.json());c.push(...t.map(t=>t.items).reduce((t,e)=>t.concat(e),[])),sessionStorage.setItem("jx3_emotion",JSON.stringify(t))}u=!1,r.forEach(t=>t())}class d{constructor(t){this.joke=String(t).trim()}async _renderHTML(t){if(!this.joke.includes("#"))return this.joke;await l();const e=Object(s["keyBy"])(c,"key");for(const n in e)if(this.joke.includes(n)){let a=e[n].filename;a.startsWith("http")||(a=`${i}emotion/output/${e[n].filename}`);let s="";const{maxWidth:o=60,maxHeight:r=60}=t||{};s+=`max-width: ${o}px;`,s+=`max-height: ${r}px;`,this.joke=this.joke.replaceAll(n,`<img src="${a}" alt="${n}" title="${n}" style="${s}" />`)}return this.joke}}e["a"]=d},"8bca":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"v-joke"},[e("div",{ref:"chatContainer",staticClass:"m-chat-container",on:{scroll:t.handleScroll}},[e("div",{ref:"chatList",staticClass:"m-chat-list"},[t._l(t.jokes,(function(n,a){var s,i;return[n.isDateMarker?[e("div",{key:n.id||a,staticClass:"u-chat-date"},[t._v(t._s(n.date))])]:[e("div",{key:n.id||a,staticClass:"m-chat-item"},[e("div",{staticClass:"m-message"},[e("div",{staticClass:"m-avatar"},[e("img",{staticClass:"u-avatar",attrs:{src:t._f("showAvatar")(null===(s=n.user_info)||void 0===s?void 0:s.user_avatar)}})]),e("div",{staticClass:"m-content"},[e("div",{staticClass:"m-header"},[e("span",{staticClass:"u-author"},[t._v(t._s((null===(i=n.user_info)||void 0===i?void 0:i.display_name)||"匿名"))])]),e("div",{staticClass:"m-body",on:{touchstart:function(e){return t.jokeTouchStart(n)},touchend:t.jokeTouchEnd}},[e("div",{staticClass:"u-text",domProps:{innerHTML:t._s(n.parsedContent)}})])])])])]]})),e("div",{staticClass:"u-ent-time"},[t._v(" "+t._s("".concat(t.userEntTime," 你已加入聊天室"))+" ")])],2)]),e("div",{staticClass:"m-send"},[e("div",{staticClass:"m-robot"},[e("svg",{class:"u-icon",attrs:{width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M17 9.75h-.75A5.246 5.246 0 0011 4.5h-.75v-.953A1.5 1.5 0 108 2.25c0 .555.3 1.042.75 1.297V4.5H8a5.246 5.246 0 00-5.25 5.25H2a.752.752 0 00-.75.75v2.25c0 .412.337.75.75.75h.75v.75a1.5 1.5 0 001.5 1.5h10.5c.832 0 1.5-.668 1.5-1.5v-.75H17c.413 0 .75-.338.75-.75V10.5a.752.752 0 00-.75-.75zm-9.105 2.01l-.885.885-.885-.885-.885.885-.885-.885.885-.885-.885-.885.885-.885.885.885.885-.885.885.885-.885.885.885.885zm6.75 0l-.885.885-.885-.885-.885.885-.885-.885.885-.885-.885-.885.885-.885.885.885.885-.885.885.885-.885.885.885.885z"}})]),e("div",{staticClass:"u-tip"},[t._v("尚未开放发送功能，长按骚话复制")])])]),e("el-drawer",{attrs:{visible:t.copyVisible,direction:"btt","custom-class":"m-joke-copy-drawer"},on:{"update:visible":function(e){t.copyVisible=e}}},[e("div",{staticClass:"m-copy-tip"},[e("img",{staticClass:"u-icon",attrs:{src:n("3e55"),alt:""}}),e("div",{staticClass:"u-text"},[t._v("复制骚话")])]),e("div",{staticClass:"u-content",domProps:{innerHTML:t._s(t.copySelectJoke.parsedContent)}}),e("div",{staticClass:"u-btn",on:{click:t.handleCopy}},[t._v("复制")])])],1)},s=[],i=n("3835"),o=n("2909"),r=n("5530"),c=n("c14f"),u=n("1da1"),l=(n("99af"),n("4de4"),n("d81d"),n("14d9"),n("e9f5"),n("910d"),n("7d54"),n("ab43"),n("a732"),n("d3b7"),n("25f0"),n("3ca3"),n("159b"),n("ddb0"),n("506c")),d=n("c8a9"),f=n("85e4"),h={name:"Joke",components:{},data:function(){return{loading:!1,jokes:[],currentPage:1,pageSize:20,scrollToBottomFlag:!0,userEntTime:"",copyVisible:!1,copySelectJoke:{},longPressTimeOut:""}},filters:{dateFormat:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return dateFormat(new Date(t))})),showAvatar:function(t){return Object(f["u"])(t)}},mounted:function(){this.fetchJokes();var t=new Date,e=t.getHours(),n=t.getMinutes();this.userEntTime="".concat(e,":").concat(n<10?"0"+n:n)},methods:{parse:function(t){return Object(u["a"])(Object(c["a"])().m((function e(){var n,a;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return n=new l["a"](t),e.n=1,n._renderHTML();case 1:return a=e.v,e.a(2,a)}}),e)})))()},fetchJokes:function(){var t=this;return Object(u["a"])(Object(c["a"])().m((function e(){var n;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:if(!t.loading){e.n=1;break}return e.a(2);case 1:t.loading=!0,n={page:t.currentPage,per:t.pageSize},Object(d["b"])(n).then(function(){var e=Object(u["a"])(Object(c["a"])().m((function e(n){var a,s,i,l,d;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return i=(null===n||void 0===n||null===(a=n.data)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.list)||[],i.reverse(),e.n=1,Promise.all(i.map(function(){var e=Object(u["a"])(Object(c["a"])().m((function e(n){var a;return Object(c["a"])().w((function(e){while(1)switch(e.n){case 0:return e.n=1,t.parse(n.content);case 1:return a=e.v,e.a(2,Object(r["a"])(Object(r["a"])({},n),{},{parsedContent:a}))}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:l=e.v,d=[].concat(Object(o["a"])(l),Object(o["a"])(t.jokes)),d.forEach((function(t){console.log(t.created_at)})),t.jokes=t.insertDateMarkers(d),t.currentPage++,t.scrollToBottomFlag&&(t.scrollToBottom(),t.scrollToBottomFlag=!1);case 2:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.loading=!1}));case 2:return e.a(2)}}),e)})))()},insertDateMarkers:function(t){var e=this;if(!t.length)return[];var n=t.filter((function(t){return!t.isDateMarker})),a=[],s=null;return n.forEach((function(n){var i=n.created_at.split("T")[0];if(i!==s){var o=t.some((function(t){return t.isDateMarker&&t.date===i}));o||a.push({isDateMarker:!0,date:e.formatDateToChinese(i),created_at:i+"T00:00:00.000Z"}),s=i}a.push(n)})),a},formatDateToChinese:function(t){var e=t.split("-"),n=Object(i["a"])(e,3),a=(n[0],n[1]),s=n[2];return"".concat(parseInt(a),"月").concat(parseInt(s),"日")},handleScroll:function(){var t=this.$refs.chatContainer;t&&0===t.scrollTop&&this.fetchJokes()},scrollToBottom:function(){var t=this;this.$nextTick((function(){var e=t.$refs.chatContainer;e&&(e.scrollTop=e.scrollHeight)}))},jokeTouchStart:function(t){var e=this;this.copySelectJoke=t,this.longPressTimeOut=setTimeout((function(){e.copyVisible=!0}),500)},jokeTouchEnd:function(){clearTimeout(this.longPressTimeOut)},handleCopy:function(){var t=this;navigator.clipboard.writeText(this.copySelectJoke.content).then((function(){t.$message({message:"复制成功",type:"success"}),t.copyVisible=!1}))}}},p=h,v=(n("0d88"),n("2877")),m=Object(v["a"])(p,a,s,!1,null,null,null);e["default"]=m.exports},a732:function(t,e,n){"use strict";var a=n("23e7"),s=n("c65b"),i=n("2266"),o=n("59ed"),r=n("825a"),c=n("46c4"),u=n("2a62"),l=n("f99f"),d=l("some",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(t){r(this);try{o(t)}catch(a){u(this,"throw",a)}if(d)return s(d,this,t);var e=c(this),n=0;return i(e,(function(e,a){if(t(e,n++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},c8a9:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return r})),n.d(e,"d",(function(){return u})),n.d(e,"c",(function(){return s})),n.d(e,"f",(function(){return c}));var a=n("41cb");function s(t){return Object(a["b"])().post("/api/joke/share",t)}var i=function(t){return Object(a["a"])().get("/api/cms/post/jokes",{params:t})};function o(t){return Object(a["a"])().get("/api/cms/post/joke/".concat(t))}var r=function(t){return Object(a["a"])().put("/api/cms/post/joke/".concat(t,"/star"))};function c(t){return Object(a["a"])().put("/api/cms/post/joke/".concat(t,"/unstar"))}var u=function(t){return Object(a["a"])().delete("/api/cms/post/joke/".concat(t))}}}]);